(()=>{var e={};e.id=442,e.ids=[442],e.modules={2518:e=>{"use strict";e.exports=require("mongodb")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},4573:e=>{"use strict";e.exports=require("node:buffer")},7598:e=>{"use strict";e.exports=require("node:crypto")},7975:e=>{"use strict";e.exports=require("node:util")},5219:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>m,serverHooks:()=>y,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>f});var a=r(2706),o=r(8203),i=r(5994),p=r(9138),n=r(4512),c=r(9187),u=r(2518),d=r(5511),l=r.n(d);let h=process.env.MONGO_URI,x=new u.MongoClient(h);async function f(e){try{let{session:t}=await p.A.auth.callback({rawRequest:e,rawResponse:null});if(!t?.shop||!t?.accessToken)throw Error("Session missing required fields (shop, accessToken)");await x.connect();let r=x.db("spotifydata").collection("sessions"),{shop:s,accessToken:a,scope:o,isOnline:i,expires:u}=t,d={shop:s,accessToken:a,scope:o,isOnline:i,expires:u,createdAt:new Date};await r.updateOne({shop:s},{$set:d},{upsert:!0});let h=l().createHmac("sha256","ef556089912a5fdeed16e37bd12da7ef").update(s).digest("hex"),f=(0,n.UL)();f.set("shop",s,{secure:!0,maxAge:604800}),f.set("hmac",h,{secure:!0,maxAge:604800});let{searchParams:m}=new URL(e.url),w=m.get("host"),g="https://e63c-223-185-56-236.ngrok-free.app".replace(/^https?:\/\//,""),y=`https://${g}/products?host=${w}&shop=${s}&hmac=${h}`;return c.NextResponse.redirect(y)}catch(e){return c.NextResponse.json({error:"Authentication failed",details:e.message},{status:500})}finally{await x.close()}}let m=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/callback/route",pathname:"/api/auth/callback",filename:"route",bundlePath:"app/api/auth/callback/route"},resolvedPagePath:"D:\\shopify_new -17-2-25\\shopify_new - 2-14-25\\shopify_new\\my-app\\src\\app\\api\\auth\\callback\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:g,serverHooks:y}=m;function k(){return(0,i.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:g})}},6487:()=>{},8335:()=>{},9138:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(4307);r(4390);let a=(0,s.LQ)({apiKey:"471b17c9e78398f85023517a4e451ddd",apiSecretKey:"ef556089912a5fdeed16e37bd12da7ef",scopes:"read_products,write_products,read_inventory".split(","),apiVersion:s.X$.January25,hostName:"https://e63c-223-185-56-236.ngrok-free.app".replace(/^https?:\/\//,""),hostScheme:"https",isEmbeddedApp:!1})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[994,512,452,832],()=>r(5219));module.exports=s})();