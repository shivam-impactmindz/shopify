module.exports = {

"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[externals]/node:crypto [external] (node:crypto, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("node:crypto", () => require("node:crypto"));

module.exports = mod;
}}),
"[externals]/node:buffer [external] (node:buffer, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("node:buffer", () => require("node:buffer"));

module.exports = mod;
}}),
"[externals]/node:crypto [external] (node:crypto, cjs) <export randomFillSync as default>": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, t: __turbopack_require_real__ } = __turbopack_context__;
{
__turbopack_esm__({
    "default": (()=>__TURBOPACK__imported__module__$5b$externals$5d2f$node$3a$crypto__$5b$external$5d$__$28$node$3a$crypto$2c$__cjs$29$__["randomFillSync"])
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$node$3a$crypto__$5b$external$5d$__$28$node$3a$crypto$2c$__cjs$29$__ = __turbopack_import__("[externals]/node:crypto [external] (node:crypto, cjs)");
}}),
"[externals]/node:http [external] (node:http, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("node:http", () => require("node:http"));

module.exports = mod;
}}),
"[externals]/node:https [external] (node:https, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("node:https", () => require("node:https"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[project]/src/app/lib/shopify.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
// src\app\utils\shopify.js
__turbopack_esm__({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$shopify$2f$shopify$2d$api$2f$dist$2f$esm$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_import__("[project]/node_modules/@shopify/shopify-api/dist/esm/lib/index.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$shopify$2f$shopify$2d$api$2f$dist$2f$esm$2f$adapters$2f$web$2d$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@shopify/shopify-api/dist/esm/adapters/web-api/index.mjs [app-route] (ecmascript)"); // ✅ Required for Next.js API routes
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$shopify$2f$shopify$2d$api$2f$dist$2f$esm$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_import__("[project]/node_modules/@shopify/shopify-api/dist/esm/lib/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$shopify$2f$shopify$2d$api$2f$dist$2f$esm$2f$lib$2f$types$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@shopify/shopify-api/dist/esm/lib/types.mjs [app-route] (ecmascript)");
;
;
const shopify = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$shopify$2f$shopify$2d$api$2f$dist$2f$esm$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["shopifyApi"])({
    apiKey: ("TURBOPACK compile-time value", "471b17c9e78398f85023517a4e451ddd"),
    apiSecretKey: ("TURBOPACK compile-time value", "ef556089912a5fdeed16e37bd12da7ef"),
    scopes: ("TURBOPACK compile-time value", "read_products,write_products,read_inventory")?.split(","),
    apiVersion: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$shopify$2f$shopify$2d$api$2f$dist$2f$esm$2f$lib$2f$types$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ApiVersion"].January25,
    hostName: ("TURBOPACK compile-time value", "https://f6d6-223-185-56-236.ngrok-free.app").replace(/^https?:\/\//, ""),
    hostScheme: "https",
    isEmbeddedApp: false
});
const __TURBOPACK__default__export__ = shopify;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/mongodb [external] (mongodb, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: __turbopack_require_real__ } = __turbopack_context__;
{
const mod = __turbopack_external_require__("mongodb", () => require("mongodb"));

module.exports = mod;
}}),
"[project]/src/app/api/auth/callback/route.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "GET": (()=>GET)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$shopify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/src/app/lib/shopify.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__ = __turbopack_import__("[externals]/mongodb [external] (mongodb, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__ = __turbopack_import__("[externals]/crypto [external] (crypto, cjs)");
;
;
;
;
;
const MONGO_URI = process.env.MONGO_URI;
const SECRET_KEY = ("TURBOPACK compile-time value", "ef556089912a5fdeed16e37bd12da7ef");
const client = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongodb__$5b$external$5d$__$28$mongodb$2c$__cjs$29$__["MongoClient"](MONGO_URI);
async function GET(req) {
    try {
        const { session } = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$lib$2f$shopify$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].auth.callback({
            rawRequest: req,
            rawResponse: null
        });
        if (!session?.shop || !session?.accessToken) {
            throw new Error("Session missing required fields (shop, accessToken)");
        }
        await client.connect();
        const database = client.db("spotifydata");
        const sessions = database.collection("sessions");
        const { shop, accessToken, scope, isOnline, expires } = session;
        const sessionData = {
            shop,
            accessToken,
            scope,
            isOnline,
            expires,
            createdAt: new Date()
        };
        await sessions.updateOne({
            shop
        }, {
            $set: sessionData
        }, {
            upsert: true
        });
        // ✅ Generate HMAC and store in cookies
        const hmac = __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].createHmac("sha256", SECRET_KEY).update(shop).digest("hex");
        const cookieStore = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
        cookieStore.set("shop", shop, {
            secure: ("TURBOPACK compile-time value", "development") === "production",
            maxAge: 60 * 60 * 24 * 7
        });
        cookieStore.set("hmac", hmac, {
            secure: ("TURBOPACK compile-time value", "development") === "production",
            maxAge: 60 * 60 * 24 * 7
        });
        const { searchParams } = new URL(req.url);
        const host = searchParams.get("host");
        const hostWithoutProtocol = ("TURBOPACK compile-time value", "https://f6d6-223-185-56-236.ngrok-free.app").replace(/^https?:\/\//, "");
        const redirectUrl = `https://${hostWithoutProtocol}/products?host=${host}&shop=${shop}&hmac=${hmac}`;
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].redirect(redirectUrl);
    } catch (error) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Authentication failed",
            details: error.message
        }, {
            status: 500
        });
    } finally{
        await client.close();
    }
} // // src/app/api/auth/callback/route.js
 // import shopify from "@/app/lib/shopify";
 // import { cookies } from "next/headers";
 // import { NextRequest, NextResponse } from "next/server";
 // import { MongoClient } from "mongodb";
 // import crypto from "crypto";
 // const MONGO_URI = process.env.MONGO_URI;
 // const SECRET_KEY = process.env.NEXT_PUBLIC_SHOPIFY_API_SECRET;
 // const client = new MongoClient(MONGO_URI);
 // export async function GET(req, res) {
 //   if (req.method !== "GET") {
 //     return NextResponse.json({ error: "Method Not Allowed" }, { status: 405 });
 //   }
 //   try {
 //     const { session } = await shopify.auth.callback({
 //       rawRequest: req,
 //       rawResponse: res,
 //     });
 //     console.log("Session received:", session);
 //     if (!session?.shop || !session?.accessToken) {
 //       throw new Error("Session missing required fields (shop, accessToken)");
 //     }
 //     // ✅ Connect to MongoDB
 //     await client.connect();
 //     const database = client.db("shopifyapp");
 //     const sessions = database.collection("sessions");
 //     // ✅ Extract session data
 //     const { shop, accessToken, scope, isOnline, expires } = session;
 //     const sessionData = {
 //       shop,
 //       accessToken,
 //       scope,
 //       isOnline,
 //       expires,
 //       createdAt: new Date(),
 //     };
 //     // ✅ Upsert session into MongoDB
 //     await sessions.updateOne(
 //       { shop },
 //       { $set: sessionData },
 //       { upsert: true }
 //     );
 //     console.log("✅ Session saved successfully:", sessionData);
 //     // // Set shop in cookies
 //     // cookies().set("shop", session.shop, {
 //     //   httpOnly: true,
 //     //   secure: process.env.NODE_ENV === "production",  // Secure cookie in production
 //     //   maxAge: 60 * 60 * 24 * 7,  // 1 week
 //     // });
 //     // Generate HMAC
 //     const hmac = crypto
 //       .createHmac('sha256', SECRET_KEY)
 //       .update(shop)
 //       .digest('hex');
 //     // ✅ Redirect to Products page with necessary params
 //     const { searchParams } = new URL(req.url);
 //     const host = searchParams.get("host");
 //     const hostWithoutProtocol = process.env.NEXT_PUBLIC_HOST.replace(/^https?:\/\//, '');
 //     const redirectUrl = `https://${hostWithoutProtocol}/products?host=${host}&shop=${session.shop}&hmac=${hmac}`;
 //     console.log("🔹 Redirecting to:", redirectUrl);
 //     return NextResponse.redirect(redirectUrl);
 //   } catch (error) {
 //     console.error("❌ Error during OAuth callback:", error);
 //     return NextResponse.json(
 //       { error: "Authentication failed", details: error.message },
 //       { status: 500 }
 //     );
 //   } finally {
 //     await client.close();
 //   }
 // }
 // // src\app\api\auth\callback\route.js
 // import shopify from "@/app/lib/shopify";
 // import { cookies } from "next/headers";
 // import { NextRequest, NextResponse } from "next/server";
 // import { MongoClient } from "mongodb";
 // const MONGO_URI = process.env.MONGO_URI;
 // const client = new MongoClient(MONGO_URI);
 // export async function GET(req, res) {
 //   if (req.method !== "GET") {
 //     return NextResponse.json({ error: "Method Not Allowed" }, { status: 405 });
 //   }
 //   try {
 //     const { session } = await shopify.auth.callback({
 //       rawRequest: req,
 //       rawResponse: res,
 //     });
 //     console.log("Session received:", session);
 //     if (!session?.shop || !session?.accessToken) {
 //       throw new Error("Session missing required fields (shop, accessToken)");
 //     }
 //     // ✅ Connect to MongoDB
 //     await client.connect();
 //     const database = client.db("shopifyapp");
 //     const sessions = database.collection("sessions");
 //     // ✅ Extract session data
 //     const { shop, accessToken, scope, isOnline, expires } = session;
 //     const sessionData = {
 //       shop,
 //       accessToken,
 //       scope,
 //       isOnline,
 //       expires,
 //       createdAt: new Date(),
 //     };
 //     // ✅ Upsert session into MongoDB
 //     const existingShop = await sessions.findOne({ shop });
 //     if (existingShop) {
 //       console.log(`Shop ${shop} already exists. Skipping session creation.`);
 //     } else {
 //       // ✅ Upsert session into MongoDB if shop doesn't exist
 //       await sessions.insertOne(sessionData);
 //       console.log("✅ Session saved successfully:", sessionData);
 //     }
 //     // ✅ Redirect to About page with necessary params
 //     const { searchParams } = new URL(req.url);
 //     const host = searchParams.get("host");
 //     // Ensure NEXT_PUBLIC_HOST does not include the protocol
 //     const hostWithoutProtocol = process.env.NEXT_PUBLIC_HOST.replace(/^https?:\/\//, '');
 //     const redirectUrl = `https://${hostWithoutProtocol}/products?host=${host}&shop=${session.shop}`;
 //     console.log("🔹 Redirecting to:", redirectUrl);
 //     return NextResponse.redirect(redirectUrl);
 //   } catch (error) {
 //     console.error("❌ Error during OAuth callback:", error);
 //     return NextResponse.json(
 //       { error: "Authentication failed", details: error.message },
 //       { status: 500 }
 //     );
 //   } finally {
 //     await client.close();
 //   }
 // }
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: __turbopack_require_real__ } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__0bbfce._.js.map