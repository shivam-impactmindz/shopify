{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file://D%3A/shopify_new%20-%202-14-25/shopify_new/my-app/src/app/products/page.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Cookies from \"js-cookie\";\r\nimport crypto from \"crypto\";\r\nimport \"@/app/styles/products.css\";\r\n\r\nconst SECRET_KEY = process.env.NEXT_PUBLIC_SHOPIFY_API_SECRET;\r\n\r\nexport default function ProductsPage() {\r\n  const [isValidShop, setIsValidShop] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [products, setProducts] = useState([]);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const verifyShopAndFetchProducts = async () => {\r\n      const params = new URLSearchParams(window.location.search);\r\n      const shop = localStorage.getItem(\"shop\");\r\n      const shopFromURL = params.get(\"shop\");\r\n      const hmac = params.get(\"hmac\");\r\n\r\n      console.log(\"Shop from URL:\", shopFromURL);\r\n      console.log(\"Shop from localStorage:\", shop);\r\n      console.log(\"HMAC from URL:\", hmac);\r\n\r\n      if (!shopFromURL || !hmac) {\r\n        router.replace(`/login?shop=${shopFromURL || \"\"}`);\r\n        return;\r\n      }\r\n\r\n      if (shop !== shopFromURL) {\r\n        router.replace(`/login?shop=${shopFromURL}`);\r\n        return;\r\n      }\r\n\r\n      // Generate HMAC on the client side\r\n      const generatedHmac = crypto.createHmac(\"sha256\", SECRET_KEY).update(shop).digest(\"hex\");\r\n      if (generatedHmac !== hmac) {\r\n        console.error(\"HMAC mismatch: Invalid shop credentials\");\r\n        router.replace(`/login?shop=${shopFromURL}`);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const verifyResponse = await fetch(\"/api/verify-shop\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ shop, hmac }),\r\n        });\r\n\r\n        const verifyData = await verifyResponse.json();\r\n        if (!verifyData.isValid) {\r\n          setIsValidShop(false);\r\n          router.replace(\"/\");\r\n          return;\r\n        }\r\n\r\n        setIsValidShop(true);\r\n\r\n        // Fetch products\r\n        const productsResponse = await fetch(`/api/products?shop=${shop}`);\r\n        const productsData = await productsResponse.json();\r\n\r\n        setProducts(productsData.products || []);\r\n      } catch (error) {\r\n        console.error(\"Error verifying shop or fetching products:\", error);\r\n        setIsValidShop(false);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    verifyShopAndFetchProducts();\r\n  }, [router]);\r\n\r\n  if (loading) return <p>Loading...</p>;\r\n  if (isValidShop === false) return <p>Shop validation failed. Redirecting...</p>;\r\n\r\n  return (\r\n    <div className=\"products-container\">\r\n      <h1>Products</h1>\r\n      {products.length === 0 ? (\r\n        <p>No products found.</p>\r\n      ) : (\r\n        <div className=\"products-grid\">\r\n          {products.map((product) => (\r\n            <div key={product.id} className=\"product-card\">\r\n              <img\r\n                src={product.image?.src || \"/placeholder.jpg\"}\r\n                alt={product.title}\r\n                className=\"product-image\"\r\n              />\r\n              <div className=\"product-info\">\r\n                <p className=\"product-title\">{product.title}</p>\r\n                <p className=\"product-price\">\r\n                  â‚¹{product.variants[0]?.price || \"N/A\"}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AAJA;;;;;;;AAOA,MAAM;AAES,SAAS;IACtB,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,EAAE;IAC3C,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,6BAA6B;YACjC,MAAM,SAAS,IAAI,gBAAgB,OAAO,QAAQ,CAAC,MAAM;YACzD,MAAM,OAAO,aAAa,OAAO,CAAC;YAClC,MAAM,cAAc,OAAO,GAAG,CAAC;YAC/B,MAAM,OAAO,OAAO,GAAG,CAAC;YAExB,QAAQ,GAAG,CAAC,kBAAkB;YAC9B,QAAQ,GAAG,CAAC,2BAA2B;YACvC,QAAQ,GAAG,CAAC,kBAAkB;YAE9B,IAAI,CAAC,eAAe,CAAC,MAAM;gBACzB,OAAO,OAAO,CAAC,CAAC,YAAY,EAAE,eAAe,IAAI;gBACjD;YACF;YAEA,IAAI,SAAS,aAAa;gBACxB,OAAO,OAAO,CAAC,CAAC,YAAY,EAAE,aAAa;gBAC3C;YACF;YAEA,mCAAmC;YACnC,MAAM,gBAAgB,qGAAA,CAAA,UAAM,CAAC,UAAU,CAAC,UAAU,YAAY,MAAM,CAAC,MAAM,MAAM,CAAC;YAClF,IAAI,kBAAkB,MAAM;gBAC1B,QAAQ,KAAK,CAAC;gBACd,OAAO,OAAO,CAAC,CAAC,YAAY,EAAE,aAAa;gBAC3C;YACF;YAEA,IAAI;gBACF,MAAM,iBAAiB,MAAM,MAAM,oBAAoB;oBACrD,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE;wBAAM;oBAAK;gBACpC;gBAEA,MAAM,aAAa,MAAM,eAAe,IAAI;gBAC5C,IAAI,CAAC,WAAW,OAAO,EAAE;oBACvB,eAAe;oBACf,OAAO,OAAO,CAAC;oBACf;gBACF;gBAEA,eAAe;gBAEf,iBAAiB;gBACjB,MAAM,mBAAmB,MAAM,MAAM,CAAC,mBAAmB,EAAE,MAAM;gBACjE,MAAM,eAAe,MAAM,iBAAiB,IAAI;gBAEhD,YAAY,aAAa,QAAQ,IAAI,EAAE;YACzC,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,8CAA8C;gBAC5D,eAAe;YACjB,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG;QAAC;KAAO;IAEX,IAAI,SAAS,qBAAO,8OAAC;kBAAE;;;;;;IACvB,IAAI,gBAAgB,OAAO,qBAAO,8OAAC;kBAAE;;;;;;IAErC,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;0BAAG;;;;;;YACH,SAAS,MAAM,KAAK,kBACnB,8OAAC;0BAAE;;;;;qCAEH,8OAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC,wBACb,8OAAC;wBAAqB,WAAU;;0CAC9B,8OAAC;gCACC,KAAK,QAAQ,KAAK,EAAE,OAAO;gCAC3B,KAAK,QAAQ,KAAK;gCAClB,WAAU;;;;;;0CAEZ,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDAAiB,QAAQ,KAAK;;;;;;kDAC3C,8OAAC;wCAAE,WAAU;;4CAAgB;4CACzB,QAAQ,QAAQ,CAAC,EAAE,EAAE,SAAS;;;;;;;;;;;;;;uBAT5B,QAAQ,EAAE;;;;;;;;;;;;;;;;AAkBhC"}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}