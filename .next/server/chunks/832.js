"use strict";exports.id=832,exports.ids=[832],exports.modules={4390:(e,t,r)=>{var n=r(245);r(2377),r(3233);var i=r(2014),s=r(7523);async function o(e){let t=e.rawRequest,r={};for(let[e,n]of t.headers.entries())(0,s.NI)(r,e,n);return{headers:r,method:t.method??"GET",url:new URL(t.url).toString()}}async function a(e,t){let r=new Headers;return(0,s.G)(e??{}).forEach(([e,t])=>r.append(e,t)),Promise.resolve(r)}async function c(e,t){return new Response(e.body,{status:e.statusCode,statusText:e.statusText,headers:await a(e.headers??{})})}(0,n.jX)(fetch),(0,n.Vr)(o),(0,n.HJ)(c),(0,n.op)(a),(0,i.c)(function(){return"Web API"})},4307:(e,t,r)=>{let n,i,s,o,a,c,l,u,p,d;r.d(t,{X$:()=>er,LQ:()=>nh});let h=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,f=e=>{if("string"!=typeof e)throw TypeError("Invalid argument expected string");let t=e.match(h);if(!t)throw Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},m=e=>"*"===e||"x"===e||"X"===e,y=e=>{let t=parseInt(e,10);return isNaN(t)?e:t},g=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],w=(e,t)=>{if(m(e)||m(t))return 0;let[r,n]=g(y(e),y(t));return r>n?1:r<n?-1:0},b=(e,t)=>{for(let r=0;r<Math.max(e.length,t.length);r++){let n=w(e[r]||"0",t[r]||"0");if(0!==n)return n}return 0},S=(e,t)=>{let r=f(e),n=f(t),i=r.pop(),s=n.pop(),o=b(r,n);return 0!==o?o:i&&s?b(i.split("."),s.split(".")):i||s?i?-1:1:0},A=(e,t,r)=>{k(r);let n=S(e,t);return v[r].includes(n)},v={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},E=Object.keys(v),k=e=>{if("string"!=typeof e)throw TypeError(`Invalid operator type, expected string but got ${typeof e}`);if(-1===E.indexOf(e))throw Error(`Invalid operator, expected one of ${E.join("|")}`)};(function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(et||(et={})),function(e){e.October22="2022-10",e.January23="2023-01",e.April23="2023-04",e.July23="2023-07",e.October23="2023-10",e.January24="2024-01",e.April24="2024-04",e.July24="2024-07",e.October24="2024-10",e.January25="2025-01",e.Unstable="unstable"}(er||(er={}));let T=er.January25;(function(e){e.AccessToken="X-Shopify-Access-Token",e.ApiVersion="X-Shopify-API-Version",e.Domain="X-Shopify-Shop-Domain",e.Hmac="X-Shopify-Hmac-Sha256",e.Topic="X-Shopify-Topic",e.SubTopic="X-Shopify-Sub-Topic",e.WebhookId="X-Shopify-Webhook-Id",e.StorefrontPrivateToken="Shopify-Storefront-Private-Token",e.StorefrontSDKVariant="X-SDK-Variant",e.StorefrontSDKVersion="X-SDK-Version"})(en||(en={})),function(e){e.Rest="rest",e.Graphql="graphql"}(ei||(ei={}));let C=["CUSTOMERS_DATA_REQUEST","CUSTOMERS_REDACT","SHOP_REDACT"];(function(e){e.OneTime="ONE_TIME",e.Every30Days="EVERY_30_DAYS",e.Annual="ANNUAL",e.Usage="USAGE"})(es||(es={})),function(e){e.ApplyImmediately="APPLY_IMMEDIATELY",e.ApplyOnNextBillingCycle="APPLY_ON_NEXT_BILLING_CYCLE",e.Standard="STANDARD"}(eo||(eo={}));class $ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class I extends ${}class P extends ${}class O extends ${}class R extends ${}class x extends ${}class _ extends ${}class D extends ${}class U extends ${}class N extends ${}class j extends ${}class M extends ${response;constructor({message:e,code:t,statusText:r,body:n,headers:i}){super(e),this.response={code:t,statusText:r,body:n,headers:i}}}class q extends M{}class H extends q{}class L extends q{constructor({retryAfter:e,...t}){super(t),this.response.retryAfter=e}}class J extends ${response;headers;body;constructor({message:e,response:t,headers:r,body:n}){super(e),this.response=t,this.headers=r,this.body=n}}class K extends ${}class W extends ${}class F extends ${}class V extends ${}class X extends ${response;constructor({message:e,response:t}){super(e),this.response=t}}class B extends X{}class z extends ${}class G extends ${}class Q extends ${errorData;constructor({message:e,errorData:t}){super(e),this.errorData=t}}class Y extends ${}let Z="11.8.1";function ee(e){let t=function(t,r,n={}){if(t>e.logger.level)return;let i=[];e.logger.timestamps&&i.push(`${new Date().toISOString().slice(0,-5)}Z`);let s=n.package||"shopify-api";switch(delete n.package,t){case et.Debug:s=`${s}/DEBUG`;break;case et.Info:s=`${s}/INFO`;break;case et.Warning:s=`${s}/WARNING`;break;case et.Error:s=`${s}/ERROR`}i.push(s);let o=[];Object.entries(n).forEach(([e,t])=>{o.push(`${e}: ${t}`)});let a="";o.length>0&&(a=` | {${o.join(", ")}}`),e.logger.log(t,`[${i.join("] [")}] ${r}${a}`)};return{log:t,debug:async(e,r={})=>t(et.Debug,e,r),info:async(e,r={})=>t(et.Info,e,r),warning:async(e,r={})=>t(et.Warning,e,r),error:async(e,r={})=>t(et.Error,e,r),deprecated:function(e,r){if(A(Z,e,">="))throw new Y(`Feature was deprecated in version ${e}`);return t(et.Warning,`[Deprecated | ${e}] ${r}`)}}}var et,er,en,ei,es,eo,ea,ec,el,eu,ep,ed,eh,ef=r(2014);class em{static SCOPE_DELIMITER=",";compressedScopes;expandedScopes;originalScopes;constructor(e){let t=[];"string"==typeof e?t=e.split(RegExp(`${em.SCOPE_DELIMITER}\\s*`)):Array.isArray(e)?t=e:e&&(t=Array.from(e.expandedScopes)),t=t.map(e=>e.trim()).filter(e=>e.length);let r=this.getImpliedScopes(t),n=new Set(t),i=new Set(r);this.compressedScopes=new Set([...n].filter(e=>!i.has(e))),this.expandedScopes=new Set([...n,...i]),this.originalScopes=n}has(e){return 0===(e instanceof em?e:new em(e)).toArray().filter(e=>!this.expandedScopes.has(e)).length}equals(e){let t;return t=e instanceof em?e:new em(e),this.compressedScopes.size===t.compressedScopes.size&&0===this.toArray().filter(e=>!t.has(e)).length}toString(){return this.toArray().join(em.SCOPE_DELIMITER)}toArray(e=!1){return e?[...this.originalScopes]:[...this.compressedScopes]}getImpliedScopes(e){return e.reduce((e,t)=>{let r=t.match(/^(unauthenticated_)?write_(.*)$/);return r&&e.push(`${r[1]?r[1]:""}read_${r[2]}`),e},[])}}function ey(e,t){switch(e){case et.Debug:console.debug(t);break;case et.Info:console.log(t);break;case et.Warning:console.warn(t);break;case et.Error:console.error(t)}}let eg="GraphQL Client",ew="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",eb="Response returned unexpected Content-Type:",eS="An unknown error has occurred. The API did not return a data object or any errors in its response.",eA={json:"application/json",multipart:"multipart/mixed"},ev="X-SDK-Variant",eE="X-SDK-Version",ek=[429,503],eT=/@(defer)\b/i,eC=/boundary="?([^=";]+)"?/i,e$="\r\n\r\n";function eI(e,t=eg){return e.startsWith(`${t}`)?e:`${t}: ${e}`}function eP(e){return e instanceof Error?e.message:JSON.stringify(e)}function eO(e){return e instanceof Error&&e.cause?e.cause:void 0}function eR(e){return e.flatMap(({errors:e})=>e??[])}function ex({client:e,retries:t}){if(void 0!==t&&("number"!=typeof t||t<0||t>3))throw Error(`${e}: The provided "retries" value (${t}) is invalid - it cannot be less than 0 or greater than 3`)}function e_(e,t){return t&&("object"!=typeof t||Array.isArray(t)||"object"==typeof t&&Object.keys(t).length>0)?{[e]:t}:{}}function eD([e,...t]){return t.reduce(function e(t,r){return Object.keys(r||{}).reduce((n,i)=>(("object"==typeof r[i]||Array.isArray(r[i]))&&t[i]?n[i]=e(t[i],r[i]):n[i]=r[i],n),Array.isArray(t)?[...t]:{...t})},{...e})}function eU({clientLogger:e,customFetchApi:t=fetch,client:r=eg,defaultRetryWaitTime:n=1e3,retriableCodes:i=ek}){let s=async(o,a,c)=>{let l;let u=a+1,p=c+1;try{if(l=await t(...o),e({type:"HTTP-Response",content:{requestParams:o,response:l}}),!l.ok&&i.includes(l.status)&&u<=p)throw Error();return l}catch(t){if(u<=p){let t=l?.headers.get("Retry-After");return await eN(t?parseInt(t,10):n),e({type:"HTTP-Retry",content:{requestParams:o,lastResponse:l,retryAttempt:a,maxRetries:c}}),s(o,u,c)}throw Error(eI(`${c>0?`Attempted maximum number of ${c} network retries. Last message - `:""}${eP(t)}`,r))}};return s}async function eN(e){return new Promise(t=>setTimeout(t,e))}function ej({headers:e,url:t,customFetchApi:r=fetch,retries:n=0,logger:i}){ex({client:eg,retries:n});let s={headers:e,url:t,retries:n},o=function(e,{url:t,headers:r,retries:n}){return async(i,s={})=>{let{variables:o,headers:a,url:c,retries:l,signal:u}=s,p=JSON.stringify({query:i,variables:o});ex({client:eg,retries:l});let d=Object.entries({...r,...a}).reduce((e,[t,r])=>(e[t]=Array.isArray(r)?r.join(", "):r.toString(),e),{});return d[ev]||d[eE]||(d[ev]="shopify-graphql-client",d[eE]="1.2.2"),e([c??t,{method:"POST",headers:d,body:p,signal:u}],1,l??n)}}(eU({customFetchApi:r,clientLogger:e=>{i&&i(e)},defaultRetryWaitTime:1e3}),s),a=async(...e)=>{if(eT.test(e[0]))throw Error(eI("This operation will result in a streamable response - use requestStream() instead."));try{let t=await o(...e),{status:r,statusText:n}=t,i=t.headers.get("content-type")||"";if(!t.ok)return{errors:{networkStatusCode:r,message:eI(n),response:t}};if(!i.includes(eA.json))return{errors:{networkStatusCode:r,message:eI(`${eb} ${i}`),response:t}};return eM(t)}catch(e){return{errors:{message:eP(e)}}}},c=async(...e)=>{if(!eT.test(e[0]))throw Error(eI("This operation does not result in a streamable response - use request() instead."));try{let t=await o(...e),{statusText:r}=t;if(!t.ok)throw Error(r,{cause:t});let n=t.headers.get("content-type")||"";switch(!0){case n.includes(eA.json):return{async *[Symbol.asyncIterator](){let e=await eM(t);yield{...e,hasNext:!1}}};case n.includes(eA.multipart):return function(e,t){let r;let n=(t??"").match(eC),i=`--${n?n[1]:"-"}`;if(!e.body?.getReader&&!e.body?.[Symbol.asyncIterator])throw Error("API multipart response did not return an iterable body",{cause:e});let s=eq(e),o={};return{async *[Symbol.asyncIterator](){try{let e=!0;for await(let t of{async *[Symbol.asyncIterator](){try{let e="";for await(let t of s)if((e+=t).indexOf(i)>-1){let t=e.lastIndexOf(i),r=e.slice(0,t).split(i).filter(e=>e.trim().length>0).map(e=>e.slice(e.indexOf(e$)+e$.length).trim());r.length>0&&(yield r),e=e.slice(t+i.length),"--"===e.trim()&&(e="")}}catch(e){throw Error(`Error occured while processing stream payload - ${eP(e)}`)}}}){let n=t.map(e=>{try{return JSON.parse(e)}catch(e){throw Error(`Error in parsing multipart response - ${eP(e)}`)}}).map(e=>{let{data:t,incremental:r,hasNext:n,extensions:i,errors:s}=e;if(!r)return{data:t||{},...e_("errors",s),...e_("extensions",i),hasNext:n};let o=r.map(({data:e,path:t,errors:r})=>({data:e&&t?function e(t,r){if(0===t.length)return r;let n={[t.pop()]:r};return 0===t.length?n:e(t,n)}(t,e):{},...e_("errors",r)}));return{data:1===o.length?o[0].data:eD([...o.map(({data:e})=>e)]),...e_("errors",eR(o)),hasNext:n}});r=n.find(e=>e.extensions)?.extensions??r;let i=eR(n);o=eD([o,...n.map(({data:e})=>e)]),e=n.slice(-1)[0].hasNext,function(e,t){if(e.length>0)throw Error(ew,{cause:{graphQLErrors:e}});if(0===Object.keys(t).length)throw Error(eS)}(i,o),yield{...e_("data",o),...e_("extensions",r),hasNext:e}}if(e)throw Error("Response stream terminated unexpectedly")}catch(n){let t=eO(n);yield{...e_("data",o),...e_("extensions",r),errors:{message:eI(eP(n)),networkStatusCode:e.status,...e_("graphQLErrors",t?.graphQLErrors),response:e},hasNext:!1}}}}}(t,n);default:throw Error(`${eb} ${n}`,{cause:t})}}catch(e){return{async *[Symbol.asyncIterator](){let t=eO(e);yield{errors:{message:eI(eP(e)),...e_("networkStatusCode",t?.status),...e_("response",t)},hasNext:!1}}}}};return{config:s,fetch:o,request:a,requestStream:c}}async function eM(e){let{errors:t,data:r,extensions:n}=await e.json();return{...e_("data",r),...e_("extensions",n),headers:e.headers,...t||!r?{errors:{networkStatusCode:e.status,message:eI(t?ew:eS),...e_("graphQLErrors",t),response:e}}:{}}}async function*eq(e){let t=new TextDecoder;if(e.body[Symbol.asyncIterator])for await(let r of e.body)yield t.decode(r);else{let r;let n=e.body.getReader();try{for(;!(r=await n.read()).done;)yield t.decode(r.value)}finally{n.cancel()}}}function eH({client:e,storeDomain:t}){try{if(!t||"string"!=typeof t)throw Error();let e=t.trim(),r=e.match(/^https?:/)?e:`https://${e}`,n=new URL(r);return n.protocol="https",n.origin}catch(r){throw Error(`${e}: a valid store domain ("${t}") must be provided`,{cause:r})}}function eL({client:e,currentSupportedApiVersions:t,apiVersion:r,logger:n}){let i=`${e}: the provided apiVersion ("${r}")`,s=`Currently supported API versions: ${t.join(", ")}`;if(!r||"string"!=typeof r)throw Error(`${i} is invalid. ${s}`);let o=r.trim();t.includes(o)||(n?n({type:"Unsupported_Api_Version",content:{apiVersion:r,supportedApiVersions:t}}):console.warn(`${i} is likely deprecated or not supported. ${s}`))}function eJ(e){let t=3*e-2;return 10===t?t:`0${t}`}function eK(e,t,r){let n=t-r;return n<=0?`${e-1}-${eJ(n+4)}`:`${e}-${eJ(n)}`}function eW(){let{year:e,quarter:t,version:r}=function(){let e=new Date,t=e.getUTCMonth(),r=e.getUTCFullYear(),n=Math.floor(t/3+1);return{year:r,quarter:n,version:`${r}-${eJ(n)}`}}(),n=4===t?`${e+1}-01`:`${e}-${eJ(t+1)}`;return[eK(e,t,3),eK(e,t,2),eK(e,t,1),r,n,"unstable"]}function eF(e){return t=>({...t??{},...e.headers})}function eV({getHeaders:e,getApiUrl:t}){return(r,n)=>{let i=[r];if(n&&Object.keys(n).length>0){let{variables:r,apiVersion:s,headers:o,retries:a}=n;i.push({...r?{variables:r}:{},...o?{headers:e(o)}:{},...s?{url:t(s)}:{},...a?{retries:a}:{}})}return i}}let eX="application/json",eB="1.0.5",ez="X-Shopify-Access-Token",eG="Admin API Client",eQ=[429,500,503];function eY(e){if(!e)throw Error(`${eG}: an access token must be provided`)}function eZ(e=!1){if("undefined"!=typeof window&&!e)throw Error(`${eG}: this client should not be used in the browser`)}function e0(e){let t={};for(let[r,n]of Object.entries(e))t[r.toLowerCase()]=Array.isArray(n)?n.join(", "):String(n);return t}!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(ea||(ea={}));var e1=r(245),e2=r(2377),e4=r(3233);(function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Patch="PATCH",e.Delete="DELETE",e.Head="HEAD",e.Options="OPTIONS",e.Connect="CONNECT"})(n||(n={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported"}(i||(i={})),function(e){e.Accept="Accept",e.AcceptEncoding="Accept-Encoding",e.AcceptLanguage="Accept-Language",e.AccessControlAllowCredentials="Access-Control-Allow-Credentials",e.AccessControlAllowHeaders="Access-Control-Allow-Headers",e.AccessControlAllowMethods="Access-Control-Allow-Methods",e.AccessControlAllowOrigin="Access-Control-Allow-Origin",e.AccessControlExposeHeaders="Access-Control-Expose-Headers",e.AccessControlMaxAge="Access-Control-Max-Age",e.AccessControlRequestHeaders="Access-Control-Request-Headers",e.AccessControlRequestMethod="Access-Control-Request-Method",e.Authorization="Authorization",e.CacheControl="Cache-Control",e.CacheStatus="Cache-Status",e.Connection="Connection",e.ContentDisposition="Content-Disposition",e.ContentEncoding="Content-Encoding",e.ContentLength="Content-Length",e.ContentSecurityPolicy="Content-Security-Policy",e.ContentSecurityPolicyReportOnly="Content-Security-Policy-Report-Only",e.ContentType="Content-Type",e.ContentTypeOptions="X-Content-Type-Options",e.Cookie="Cookie",e.DownloadOptions="X-Download-Options",e.ETag="ETag",e.Forwarded="Forwarded",e.ForwardedFor="X-Forwarded-For",e.ForwardedHost="X-Forwarded-Host",e.ForwardedProtocol="X-Forwarded-Proto",e.FrameOptions="X-Frame-Options",e.Host="Host",e.IfNoneMatch="If-None-Match",e.Location="Location",e.Origin="Origin",e.ReferrerPolicy="Referrer-Policy",e.ServerTiming="Server-Timing",e.StrictTransportSecurity="Strict-Transport-Security",e.TimingAllowOrigin="Timing-Allow-Origin",e.Trailer="Trailer",e.TransferEncoding="Transfer-Encoding",e.UserAgent="User-Agent",e.WwwAuthenticate="WWW-Authenticate",e.XhrRedirectedTo="X-XHR-Redirected-To",e.XhrReferer="X-XHR-Referer",e.XssProtecton="X-XSS-Protection",e.XContentTypeOptions="X-Content-Type-Options",e.XDownloadOptions="X-Download-Options",e.XForwardedFor="X-Forwarded-For",e.XForwardedHost="X-Forwarded-Host",e.XForwardedProto="X-Forwarded-Proto",e.XFrameOptions="X-Frame-Options",e.XXhrRedirectedTo="X-XHR-Redirected-To",e.XXhrReferer="X-XHR-Referer",e.XXssProtecton="X-XSS-Protection",e.XXssProtection="X-XSS-Protection"}(s||(s={})),function(e){e.ChildSrc="child-src",e.ConnectSrc="connect-src",e.DefaultSrc="default-src",e.FontSrc="font-src",e.FrameSrc="frame-src",e.ImgSrc="img-src",e.ManifestSrc="manifest-src",e.MediaSrc="media-src",e.ObjectSrc="object-src",e.PrefetchSrc="prefetch-src",e.ScriptSrc="script-src",e.StyleSrc="style-src",e.WebrtcSrc="webrtc-src",e.WorkerSrc="worker-src",e.BaseUri="base-uri",e.PluginTypes="plugin-types",e.Sandbox="sandbox",e.FormAction="form-action",e.FrameAncestors="frame-ancestors",e.ReportUri="report-uri",e.BlockAllMixedContent="block-all-mixed-content",e.RequireSriFor="require-sri-for",e.UpgradeInsecureRequests="upgrade-insecure-requests"}(o||(o={})),function(e){e.Forms="allow-forms",e.SameOrigin="allow-same-origin",e.Scripts="allow-scripts",e.Popups="allow-popups",e.Modals="allow-modals",e.OrientationLock="allow-orientation-lock",e.PointerLock="allow-pointer-lock",e.Presentation="allow-presentation",e.PopupsToEscapeSandbox="allow-popups-to-escape-sandbox",e.TopNavigation="allow-top-navigation"}(a||(a={})),function(e){e.Any="*",e.Self="'self'",e.UnsafeInline="'unsafe-inline'",e.UnsafeEval="'unsafe-eval'",e.None="'none'",e.StrictDynamic="'strict-dynamic'",e.ReportSample="'report-sample'",e.Data="data:",e.Blob="blob:",e.FileSystem="filesystem:"}(c||(c={})),function(e){e.Script="script",e.Style="style"}(l||(l={})),function(e){e.Sha256="sha256",e.Sha384="sha384",e.Sha512="sha512"}(u||(u={})),function(e){e.Informational="1xx",e.Success="2xx",e.Redirection="3xx",e.ClientError="4xx",e.ServerError="5xx",e.Unknown="Unknown"}(p||(p={})),function(e){e.NoCache="no-cache",e.NoStore="no-store",e.MustRevalidate="must-revalidate",e.MaxAge="max-age"}(d||(d={}));var e5=r(7523);function e3(e){let t=`Shopify API Library v${Z} | ${(0,ef.e)()}`;return e.userAgentPrefix&&(t=`${e.userAgentPrefix} | ${t}`),t}function e6(e){return t=>{if(e.logger.httpRequests)switch(t.type){case"HTTP-Response":{let r=t.content;ee(e).debug("Received response for HTTP request",{requestParams:JSON.stringify(r.requestParams),response:JSON.stringify(r.response)});break}case"HTTP-Retry":{let r=t.content;ee(e).debug("Retrying HTTP request",{requestParams:JSON.stringify(r.requestParams),retryAttempt:r.retryAttempt,maxRetries:r.maxRetries,response:JSON.stringify(r.lastResponse)});break}default:ee(e).debug(`HTTP request event: ${t.content}`)}}}function e8(e,t,r){if(void 0===r){let t=e?.errors?.message??"";throw new N(`Http request error, no response available: ${t}`)}let n=(0,e5.H7)(Object.fromEntries(r.headers.entries()??[]));if(r.status===i.Ok&&e.errors.graphQLErrors)throw new J({message:e.errors.graphQLErrors?.[0].message??"GraphQL operation failed",response:r,headers:n,body:e});let s=[];e.errors&&s.push(JSON.stringify(e.errors,null,2));let o=(0,e5._b)(n,"x-request-id");o&&s.push(`If you report this error, please include this id: ${o}`);let a=s.length?`:
${s.join("\n")}`:"",c=r.status,l=r.statusText;switch(!0){case r.status===i.TooManyRequests:if(t)throw new j("Attempted the maximum number of retries for HTTP request.");{let t=(0,e5._b)(n,"Retry-After");throw new L({message:`Shopify is throttling requests ${a}`,code:c,statusText:l,body:e,headers:n,retryAfter:t?parseFloat(t):void 0})}case r.status>=i.InternalServerError:if(t)throw new j("Attempted the maximum number of retries for HTTP request.");throw new H({message:`Shopify internal error${a}`,code:c,statusText:l,body:e,headers:n});default:throw new M({message:`Received an error response (${r.status} ${r.statusText}) from Shopify${a}`,code:c,statusText:l,body:e,headers:n})}}class e9{static config;session;client;apiVersion;constructor(e){let t=this.graphqlClass().config;if(!t.isCustomStoreApp&&!e.session.accessToken)throw new z("Missing access token when creating GraphQL client");if(e.apiVersion){let r=e.apiVersion===t.apiVersion?`Admin client has a redundant API version override to the default ${e.apiVersion}`:`Admin client overriding default API version ${t.apiVersion} with ${e.apiVersion}`;ee(t).debug(r)}this.session=e.session,this.apiVersion=e.apiVersion,this.client=function({storeDomain:e,apiVersion:t,accessToken:r,userAgentPrefix:n,retries:i=0,customFetchApi:s,logger:o,isTesting:a}){var c;let l=eW(),u=eH({client:eG,storeDomain:e});eZ(a),eL({client:eG,currentSupportedApiVersions:l,apiVersion:t,logger:o}),eY(r);let p=(c={client:eG,currentSupportedApiVersions:l,logger:o},e=>{e&&eL({...c,apiVersion:e});let r=(e??t).trim();return`${u}/admin/api/${r}/graphql.json`}),d={storeDomain:u,apiVersion:t,accessToken:r,headers:{"Content-Type":eX,Accept:eX,[ez]:r,"User-Agent":`${n?`${n} | `:""}${eG} v${eB}`},apiUrl:p(),userAgentPrefix:n},h=ej({headers:d.headers,url:d.apiUrl,retries:i,customFetchApi:s,logger:o}),f=eF(d),m=e=>e?p(e):d.apiUrl,y=eV({getHeaders:f,getApiUrl:m});return Object.freeze({config:d,getHeaders:f,getApiUrl:m,fetch:(...e)=>h.fetch(...y(...e)),request:(...e)=>h.request(...y(...e))})}({accessToken:t.adminApiAccessToken??this.session.accessToken,apiVersion:this.apiVersion??t.apiVersion,storeDomain:this.session.shop,customFetchApi:e1.lY,logger:e6(t),userAgentPrefix:e3(t),isTesting:t.isTesting})}async query(e){let t,r;if(ee(this.graphqlClass().config).deprecated("12.0.0","The query method is deprecated, and was replaced with the request method.\nSee the migration guide: https://github.com/Shopify/shopify-app-js/blob/main/packages/apps/shopify-api/docs/migrating-to-v9.md#using-the-new-clients."),"string"==typeof e.data&&0===e.data.length||0===Object.entries(e.data).length)throw new z("Query missing.");"string"==typeof e.data?t=e.data:(t=e.data.query,r=e.data.variables);let n=Object.fromEntries(Object.entries(e?.extraHeaders??{}).map(([e,t])=>[e,Array.isArray(t)?t.join(", "):t.toString()]));return{body:await this.request(t,{headers:n,retries:e.tries?e.tries-1:void 0,variables:r}),headers:{}}}async request(e,t){let r=await this.client.request(e,{apiVersion:this.apiVersion||this.graphqlClass().config.apiVersion,...t});if(r.errors){let e=r.errors.response;e8(r,(t?.retries??0)>0,e)}let n=Object.fromEntries(r.headers?r.headers.entries():[]);return{...r,headers:(0,e5.H7)(n??{})}}graphqlClass(){return this.constructor}}function e7({config:e}){class t extends e9{static config=e}return Reflect.defineProperty(t,"name",{value:"GraphqlClient"}),t}async function te(e,t,r=e2.C.Base64){let n=void 0===e4.E?.webcrypto?e4.E:e4.E.webcrypto,i=new TextEncoder,s=await n.subtle.importKey("raw",i.encode(e),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),o=await n.subtle.sign("HMAC",s,i.encode(t));return r===e2.C.Base64?tn(o):tt(o)}function tt(e){return[...new Uint8Array(e)].map(e=>e.toString(16).padStart(2,"0")).join("")}let tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function tn(e){let t="",r=new Uint8Array(e);for(let e=0;e<r.length;){let n=r[e++],i=r[e++],s=r[e++],o=n>>2,a=(3&n)<<4|i>>4,c=(15&i)<<2|s>>6,l=63&s;isNaN(i)&&(c=64),isNaN(s)&&(l=64),t+=tr[o]+tr[a]+tr[c]+tr[l]}return t}class ti{static config;static formatPaths;static LINK_HEADER_REGEXP=/<([^<]+)>; rel="([^"]+)"/;static DEFAULT_LIMIT="50";static RETRY_WAIT_TIME=1e3;static DEPRECATION_ALERT_DELAY=3e5;loggedDeprecations={};client;session;apiVersion;constructor({session:e,apiVersion:t}){let r=this.restClass().config;if(!r.isCustomStoreApp&&!e.accessToken)throw new z("Missing access token when creating REST client");if(t){let e=t===r.apiVersion?`REST client has a redundant API version override to the default ${t}`:`REST client overriding default API version ${r.apiVersion} with ${t}`;ee(r).debug(e)}let n=r.adminApiAccessToken??r.apiSecretKey;this.session=e,this.apiVersion=t??r.apiVersion,this.client=function({storeDomain:e,apiVersion:t,accessToken:r,userAgentPrefix:n,logger:i,customFetchApi:s=fetch,retries:o=0,scheme:a="https",defaultRetryTime:c=1e3,formatPaths:l=!0,isTesting:u}){let p=eW(),d=eH({client:eG,storeDomain:e}).replace("https://",`${a}://`);eZ(u),eL({client:eG,currentSupportedApiVersions:p,apiVersion:t,logger:i}),eY(r),ex({client:eG,retries:o});let h=function(e,t,r,n=!0){return(i,s,o)=>{o&&eL({...r,apiVersion:o});let a=(o??t).trim(),c=i.replace(/^\//,"");n&&(c.startsWith("admin")||(c=`admin/api/${a}/${c}`),c.endsWith(".json")||(c=`${c}.json`));let l=new URLSearchParams;if(s)for(let[e,t]of Object.entries(s))!function e(t,r,n){if(Array.isArray(n)){n.forEach(n=>e(t,`${r}[]`,n));return}if("object"==typeof n){Object.entries(n).forEach(([n,i])=>e(t,`${r}[${n}]`,i));return}t.append(r,String(n))}(l,e,t);let u=l.toString()?`?${l.toString()}`:"";return`${e}/${c}${u}`}}(d,t,{client:eG,currentSupportedApiVersions:p,logger:i},l),f=eU({customFetchApi:s,clientLogger:e=>{i&&i(e)},defaultRetryWaitTime:c,client:eG,retriableCodes:eQ}),m=async(e,{method:t,data:i,headers:s,searchParams:a,retries:c=0,apiVersion:l})=>{ex({client:eG,retries:c});let u=h(e,a??{},l),p=e0(s??{}),d=[...p["user-agent"]?[p["user-agent"]]:[],...n?[n]:[],`${eG} v${eB}`].join(" | "),m=e0({"Content-Type":eX,...p,Accept:eX,[ez]:r,"User-Agent":d}),y=i&&"string"!=typeof i?JSON.stringify(i):i;return f([u,{method:t,headers:m,...y?{body:y}:void 0}],1,c??o)};return{get:(e,t)=>m(e,{method:ea.Get,...t}),put:(e,t)=>m(e,{method:ea.Put,...t}),post:(e,t)=>m(e,{method:ea.Post,...t}),delete:(e,t)=>m(e,{method:ea.Delete,...t})}}({scheme:r.hostScheme,storeDomain:e.shop,apiVersion:t??r.apiVersion,accessToken:r.isCustomStoreApp?n:e.accessToken,customFetchApi:e1.lY,logger:e6(r),userAgentPrefix:e3(r),defaultRetryTime:this.restClass().RETRY_WAIT_TIME,formatPaths:this.restClass().formatPaths,isTesting:r.isTesting})}async get(e){return this.request({method:n.Get,...e})}async post(e){return this.request({method:n.Post,...e})}async put(e){return this.request({method:n.Put,...e})}async delete(e){return this.request({method:n.Delete,...e})}async request(e){let t;let r={headers:{...e.extraHeaders,...e.type?{"Content-Type":e.type.toString()}:{}},retries:e.tries?e.tries-1:void 0,searchParams:e.query};switch(e.method){case n.Get:t=await this.client.get(e.path,r);break;case n.Put:t=await this.client.put(e.path,{...r,data:e.data});break;case n.Post:t=await this.client.post(e.path,{...r,data:e.data});break;case n.Delete:t=await this.client.delete(e.path,r);break;default:throw new G(`Unsupported request method '${e.method}'`)}let i=await t.text(),s=e.method===n.Delete&&""===i?{}:JSON.parse(i),o=(0,e5.H7)(Object.fromEntries(t.headers.entries()));t.ok||e8(s,(e.tries??1)>1,t);let a={body:s,headers:o};await this.logDeprecations({method:e.method,url:e.path,headers:r.headers,body:e.data?JSON.stringify(e.data):void 0},a);let c=t.headers.get("Link");if(void 0!==c){let t={limit:e.query?.limit?e.query?.limit.toString():ti.DEFAULT_LIMIT};if(c)for(let e of c.split(", ")){let r=e.match(ti.LINK_HEADER_REGEXP);if(!r)continue;let n=r[2],i=new URL(r[1]),s=i.searchParams.get("fields"),o=i.searchParams.get("page_info");if(!t.fields&&s&&(t.fields=s.split(",")),o)switch(n){case"previous":t.previousPageUrl=r[1],t.prevPage=this.buildRequestParams(r[1]);break;case"next":t.nextPageUrl=r[1],t.nextPage=this.buildRequestParams(r[1])}}a.pageInfo=t}return a}restClass(){return this.constructor}buildRequestParams(e){let t=new URL(e);return{path:t.pathname.replace(RegExp("^/admin/api/[^/]+/(.*).json$"),"$1"),query:Object.fromEntries(t.searchParams.entries())}}async logDeprecations(e,t){let r=this.restClass().config,n=(0,e5._b)(t.headers,"X-Shopify-API-Deprecated-Reason");if(n){let t={message:n,path:e.url};e.body&&(t.body=`${e.body.substring(0,100)}...`);let i=await te(r.apiSecretKey,JSON.stringify(t),e2.C.Hex);if(!Object.keys(this.loggedDeprecations).includes(i)||Date.now()-this.loggedDeprecations[i]>=ti.DEPRECATION_ALERT_DELAY){this.loggedDeprecations[i]=Date.now();let e=Error().stack,n=`API Deprecation Notice ${new Date().toLocaleString()} : ${JSON.stringify(t)}  -  Stack Trace: ${e}`;await ee(r).warning(n)}}}}function ts(e){let{config:t,formatPaths:r}=e;class n extends ti{static config=t;static formatPaths=void 0===r||r}return Reflect.defineProperty(n,"name",{value:"RestClient"}),n}let to="application/json",ta="Storefront API Client";class tc{static config;session;client;apiVersion;constructor(e){let t;let r=this.storefrontClass().config;if(!r.isCustomStoreApp&&!e.session.accessToken)throw new z("Missing access token when creating GraphQL client");if(e.apiVersion){let t=e.apiVersion===r.apiVersion?`Storefront client has a redundant API version override to the default ${e.apiVersion}`:`Storefront client overriding default API version ${r.apiVersion} with ${e.apiVersion}`;ee(r).debug(t)}if(r.isCustomStoreApp){if(!(t=r.privateAppStorefrontAccessToken))throw new z("Custom store apps must set the privateAppStorefrontAccessToken property to call the Storefront API.")}else if(!(t=e.session.accessToken))throw new z("Session missing access token.");this.session=e.session,this.apiVersion=e.apiVersion,this.client=function({storeDomain:e,apiVersion:t,publicAccessToken:r,privateAccessToken:n,clientName:i,retries:s=0,customFetchApi:o,logger:a}){let c=eW(),l=eH({client:ta,storeDomain:e}),u={client:ta,currentSupportedApiVersions:c,logger:a};eL({...u,apiVersion:t}),function(e,t){if(!e&&!t)throw Error(`${ta}: a public or private access token must be provided`);if(e&&t)throw Error(`${ta}: only provide either a public or private access token`)}(r,n),function(e){if(e&&"undefined"!=typeof window)throw Error(`${ta}: private access tokens and headers should only be used in a server-to-server implementation. Use the public API access token in nonserver environments.`)}(n);let p=e=>{e&&eL({...u,apiVersion:e});let r=(e??t).trim();return`${l}/api/${r}/graphql.json`},d={storeDomain:l,apiVersion:t,...r?{publicAccessToken:r}:{privateAccessToken:n},headers:{"Content-Type":to,Accept:to,"X-SDK-Variant":"storefront-api-client","X-SDK-Version":"1.0.4",...i?{"X-SDK-Variant-Source":i}:{},...r?{"X-Shopify-Storefront-Access-Token":r}:{"Shopify-Storefront-Private-Token":n}},apiUrl:p(),clientName:i},h=ej({headers:d.headers,url:d.apiUrl,retries:s,customFetchApi:o,logger:a}),f=eF(d),m=e=>e?p(e):d.apiUrl,y=eV({getHeaders:f,getApiUrl:m});return Object.freeze({config:d,getHeaders:f,getApiUrl:m,fetch:(...e)=>h.fetch(...y(...e)),request:(...e)=>h.request(...y(...e)),requestStream:(...e)=>h.requestStream(...y(...e))})}({privateAccessToken:t,apiVersion:this.apiVersion??r.apiVersion,storeDomain:this.session.shop,customFetchApi:e1.lY,logger:e6(r),clientName:e3(r)})}async query(e){let t,r;if(ee(this.storefrontClass().config).deprecated("12.0.0","The query method is deprecated, and was replaced with the request method.\nSee the migration guide: https://github.com/Shopify/shopify-app-js/blob/main/packages/apps/shopify-api/docs/migrating-to-v9.md#using-the-new-clients."),"string"==typeof e.data&&0===e.data.length||0===Object.entries(e.data).length)throw new z("Query missing.");"string"==typeof e.data?t=e.data:(t=e.data.query,r=e.data.variables);let n=Object.fromEntries(Object.entries(e?.extraHeaders??{}).map(([e,t])=>[e,Array.isArray(t)?t.join(", "):t.toString()]));return{body:await this.request(t,{headers:n,retries:e.tries?e.tries-1:void 0,variables:r}),headers:{}}}async request(e,t){let r=await this.client.request(e,{apiVersion:this.apiVersion||this.storefrontClass().config.apiVersion,...t});if(r.errors){let e=r.errors.response;e8(r,(t?.retries??0)>0,e)}return r}storefrontClass(){return this.constructor}}var tl=/bot|crawl|http|lighthouse|scan|search|spider/i;function tu(e){return!!e&&(function(){if(ec instanceof RegExp)return ec;try{ec=RegExp(" daum[ /]| deusu/| yadirectfetcher|(?:^|[^g])news(?!sapphire)|(?<! (?:channel/|google/))google(?!(app|/google| pixel))|(?<! cu)bots?(?:\\b|_)|(?<!(?:lib))http|(?<![hg]m)score|@[a-z][\\w-]+\\.|\\(\\)|\\.com\\b|\\btime/|^<|^[\\w \\.\\-\\(?:\\):%]+(?:/v?\\d+(?:\\.\\d+)?(?:\\.\\d{1,10})*?)?(?:,|$)|^[^ ]{50,}$|^\\d+\\b|^\\w*search\\b|^\\w+/[\\w\\(\\)]*$|^active|^ad muncher|^amaya|^avsdevicesdk/|^biglotron|^bot|^bw/|^clamav[ /]|^client/|^cobweb/|^custom|^ddg[_-]android|^discourse|^dispatch/\\d|^downcast/|^duckduckgo|^email|^facebook|^getright/|^gozilla/|^hobbit|^hotzonu|^hwcdn/|^igetter/|^jeode/|^jetty/|^jigsaw|^microsoft bits|^movabletype|^mozilla/5\\.0\\s[a-z\\.-]+$|^mozilla/\\d\\.\\d \\(compatible;?\\)$|^mozilla/\\d\\.\\d \\w*$|^navermailapp|^netsurf|^offline|^openai/|^owler|^php|^postman|^python|^rank|^read|^reed|^rest|^rss|^snapchat|^space bison|^svn|^swcd |^taringa|^thumbor/|^track|^w3c|^webbandit/|^webcopier|^wget|^whatsapp|^wordpress|^xenu link sleuth|^yahoo|^yandex|^zdm/\\d|^zoom marketplace/|^{{.*}}$|adscanner/|analyzer|archive|ask jeeves/teoma|audit|bit\\.ly/|bluecoat drtr|browsex|burpcollaborator|capture|catch|check\\b|checker|chrome-lighthouse|chromeframe|classifier|cloudflare|convertify|cookiehubscan|crawl|cypress/|dareboost|datanyze|dejaclick|detect|dmbrowser|download|evc-batch/|exaleadcloudview|feed|firephp|functionize|gomezagent|headless|httrack|hubspot marketing grader|hydra|ibisbrowser|images|infrawatch|insight|inspect|iplabel|ips-agent|java(?!;)|jsjcw_scanner|library|linkcheck|mail\\.ru/|manager|measure|neustar wpm|node|nutch|offbyone|optimize|pageburst|pagespeed|parser|perl|phantomjs|pingdom|powermarks|preview|proxy|ptst[ /]\\d|reputation|resolver|retriever|rexx;|rigor|rss\\b|scanner\\.|scrape|server|sogou|sparkler/|speedcurve|spider|splash|statuscake|supercleaner|synapse|synthetic|tools|torrent|trace|transcoder|url|validator|virtuoso|wappalyzer|webglance|webkit2png|whatcms/|zgrab","i")}catch(e){ec=tl}return ec})().test(e)}class tp{static stringify(e){return e&&0!==Object.keys(e).length?new tp().putAll(e).stringify():""}processedQuery;constructor(){this.processedQuery=new URLSearchParams}putAll(e){return Object.entries(e).forEach(([e,t])=>this.put(e,t)),this}put(e,t){Array.isArray(t)?this.putArray(e,t):t?.constructor===Object?this.putObject(e,t):this.putSimple(e,t)}putArray(e,t){t.forEach(t=>this.processedQuery.append(`${e}[]`,`${t}`))}putObject(e,t){Object.entries(t).forEach(([t,r])=>{this.processedQuery.append(`${e}[${t}]`,`${r}`)})}putSimple(e,t){this.processedQuery.append(e,`${t}`)}stringify(e=!1){let t=this.processedQuery.toString();return e?t:`?${t}`}}let td=(e,t)=>{if(typeof e==typeof t){let r=new TextEncoder,n=r.encode(JSON.stringify(e)),i=r.encode(JSON.stringify(t));if(n.length===i.length)return function(e,t){let r=new Uint8Array(e),n=new Uint8Array(t),i=0;for(let e=0;e<r.length;e++)i|=r[e]^n[e];return 0===i}(n,i)}else throw new D(`Mismatched data types provided: ${typeof e} and ${typeof t}`);return!1};!function(e){e.Flow="flow",e.Webhook="webhook",e.FulfillmentService="fulfillment_service"}(el||(el={}));let th={MissingBody:"missing_body",InvalidHmac:"invalid_hmac",MissingHmac:"missing_hmac"};function tf(e){return async(t,{signator:r}={signator:"admin"})=>{if("admin"===r&&!t.hmac)throw new I("Query does not contain an HMAC value.");if("appProxy"===r&&!t.signature)throw new I("Query does not contain a signature value.");return function(e){if(Math.abs(Math.trunc(Date.now()/1e3)-Number(e.timestamp))>90)throw new I("HMAC timestamp is outside of the tolerance range")}(t),td("appProxy"===r?t.signature:t.hmac,await (async(t,r="admin")=>{let{hmac:n,signature:i,...s}=t,o="admin"===r?function(e){let t=new tp;return Object.keys(e).sort((e,t)=>e.localeCompare(t)).forEach(r=>t.put(r,e[r])),t.stringify(!0)}(s):Object.entries(s).sort(([e],[t])=>e.localeCompare(t)).reduce((e,[t,r])=>`${e}${t}=${Array.isArray(r)?r.join(","):r}`,"");return te(e.apiSecretKey,o,e2.C.Hex)})(t,r))}}async function tm(e,t,r,n){return td(r,await te(e.apiSecretKey,t,n))}function ty(e){return async function({type:t,rawBody:r,...n}){let i=await (0,e1.ph)(n);if(!r.length)return tg(th.MissingBody,t,e);let s=(0,e5._b)(i.headers,en.Hmac);return s?await tm(e,r,s,e2.C.Base64)?tw(t,e):tg(th.InvalidHmac,t,e):tg(th.MissingHmac,t,e)}}async function tg(e,t,r){let n=ee(r);return await n.debug(`${t} request is not valid`,{reason:e}),{valid:!1,reason:e}}async function tw(e,t){let r=ee(t);return await r.debug(`${e} request is valid`),{valid:!0}}function tb(e){let t=tA(e);if("admin"!==t.split(".")[0])return null;let r=RegExp("admin\\..+/store/([^/]+)"),n=t.match(r);if(!n||2!==n.length)return null;{let e=n[1];return t.includes("spin.dev/store/")?function(e){let t=RegExp("admin\\.web\\.(.+\\.spin\\.dev)/store/(.+)"),r=e.match(t);if(!r||3!==r.length)return null;{let e=r[1],t=r[2];return`${t}.shopify.${e}`}}(t):`${e}.myshopify.com`}}function tS(e){let t=tA(e),r=RegExp("(.+)\\.myshopify\\.com$"),n=t.match(r);if(n&&2===n.length){let e=n[1];return`admin.shopify.com/store/${e}`}return t.endsWith("spin.dev")?function(e){let t=RegExp("(.+)\\.shopify\\.(.+\\.spin\\.dev)"),r=e.match(t);if(!r||3!==r.length)return null;{let e=r[1],t=r[2];return`admin.web.${t}/store/${e}`}}(t):null}function tA(e){return e.replace(/^https?:\/\//,"").replace(/\/$/,"")}function tv(e){return(t,r=!1)=>{let n=t,i=["myshopify\\.com","shopify\\.com","myshopify\\.io"];e.customShopDomains&&i.push(...e.customShopDomains.map(e=>"string"==typeof e?e:e.source));let s=RegExp(`^[a-zA-Z0-9][a-zA-Z0-9-_]*\\.(${i.join("|")})[/]*$`);RegExp(`^admin\\.(${i.join("|")})/store/([a-zA-Z0-9][a-zA-Z0-9-_]*)$`).test(n)&&(n=tb(n)||"");let o=s.test(n)?n:null;if(!o&&r)throw new P("Received invalid shop argument");return o}}function tE(){return(e,t=!1)=>{let r=/^[0-9a-zA-Z+/]+={0,2}$/.test(e)?e:null;if(r){let{hostname:e}=new URL(`https://${atob(r)}`);RegExp("\\.(myshopify\\.com|shopify\\.com|myshopify\\.io|spin\\.dev)$").test(e)||(r=null)}if(!r&&t)throw new O("Received invalid host argument");return r}}function tk(e){return async function(t,r){let n=ee(e),i=e.logger.httpRequests&&e.logger.level===et.Debug;i&&n.debug("Making HTTP request",{method:r?.method||"GET",url:t,...r?.body&&{body:r?.body}});let s=await (0,e1.lY)(t,r);return i&&n.debug("HTTP request completed",{method:r?.method||"GET",url:t,status:s.status}),s}}!function(e){e.JSON="application/json",e.GraphQL="application/graphql",e.URLEncoded="application/x-www-form-urlencoded"}(eu||(eu={}));let tT="shopify_app_session",tC="shopify_app_state";function t$(){return e4.E.getRandomValues(new Uint8Array(15)).map(e=>e%10).join("")}var tI=r(5511);let tP={randomUUID:tI.randomUUID},tO=new Uint8Array(256),tR=tO.length,tx=[];for(let e=0;e<256;++e)tx.push((e+256).toString(16).slice(1));let t_=function(e,t,r){if(tP.randomUUID&&!t&&!e)return tP.randomUUID();let n=(e=e||{}).random??e.rng?.()??(tR>tO.length-16&&((0,tI.randomFillSync)(tO),tR=0),tO.slice(tR,tR+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(tx[e[t+0]]+tx[e[t+1]]+tx[e[t+2]]+tx[e[t+3]]+"-"+tx[e[t+4]]+tx[e[t+5]]+"-"+tx[e[t+6]]+tx[e[t+7]]+"-"+tx[e[t+8]]+tx[e[t+9]]+"-"+tx[e[t+10]]+tx[e[t+11]]+tx[e[t+12]]+tx[e[t+13]]+tx[e[t+14]]+tx[e[t+15]]).toLowerCase()}(n)},tD=["id","shop","state","isOnline","scope","accessToken","expires","onlineAccessInfo"];class tU{static fromPropertyArray(e,t=!1){if(!Array.isArray(e))throw new V("The parameter is not an array: a Session cannot be created from this object.");let r=Object.fromEntries(e.filter(([e,t])=>null!=t).map(([e,t])=>{switch(e.toLowerCase()){case"isonline":return["isOnline",t];case"accesstoken":return["accessToken",t];case"onlineaccessinfo":return["onlineAccessInfo",t];case"userid":return["userId",t];case"firstname":return["firstName",t];case"lastname":return["lastName",t];case"accountowner":return["accountOwner",t];case"emailverified":return["emailVerified",t];default:return[e.toLowerCase(),t]}})),n={},i={associated_user:{}};return Object.entries(r).forEach(([e,r])=>{switch(e){case"isOnline":"string"==typeof r?n[e]="true"===r.toString().toLowerCase():"number"==typeof r?n[e]=!!r:n[e]=r;break;case"scope":n[e]=r.toString();break;case"expires":n[e]=r?new Date(Number(r)):void 0;break;case"onlineAccessInfo":i.associated_user.id=Number(r);break;case"userId":if(t){i.associated_user.id=Number(r);break}case"firstName":if(t){i.associated_user.first_name=String(r);break}case"lastName":if(t){i.associated_user.last_name=String(r);break}case"email":if(t){i.associated_user.email=String(r);break}case"accountOwner":if(t){i.associated_user.account_owner=!!r;break}case"locale":if(t){i.associated_user.locale=String(r);break}case"collaborator":if(t){i.associated_user.collaborator=!!r;break}case"emailVerified":if(t){i.associated_user.email_verified=!!r;break}default:n[e]=r}}),n.isOnline&&(n.onlineAccessInfo=i),new tU(n)}id;shop;state;isOnline;scope;expires;accessToken;onlineAccessInfo;constructor(e){Object.assign(this,e)}isActive(e){let t=!!this.accessToken,r=!this.isExpired();return!this.isScopeChanged(e)&&t&&r}isScopeChanged(e){return void 0!==e&&!this.isScopeIncluded(e)}isScopeIncluded(e){let t=e instanceof em?e:new em(e);return new em(this.scope).has(t)}isExpired(e=0){return!!(this.expires&&this.expires.getTime()-e<Date.now())}toObject(){let e={id:this.id,shop:this.shop,state:this.state,isOnline:this.isOnline};return this.scope&&(e.scope=this.scope),this.expires&&(e.expires=this.expires),this.accessToken&&(e.accessToken=this.accessToken),this.onlineAccessInfo&&(e.onlineAccessInfo=this.onlineAccessInfo),e}equals(e){if(!e||!(this.id===e.id&&this.shop===e.shop&&this.state===e.state&&this.isOnline===e.isOnline))return!1;let t=this.toPropertyArray(!0);t.sort(([e],[t])=>e<t?-1:1);let r=e.toPropertyArray(!0);return r.sort(([e],[t])=>e<t?-1:1),JSON.stringify(t)===JSON.stringify(r)}toPropertyArray(e=!1){return Object.entries(this).filter(([e,t])=>tD.includes(e)&&null!=t).flatMap(([t,r])=>{switch(t){case"expires":return[[t,r?r.getTime():void 0]];case"onlineAccessInfo":if(!e)return[[t,r.associated_user.id]];return[["userId",r?.associated_user?.id],["firstName",r?.associated_user?.first_name],["lastName",r?.associated_user?.last_name],["email",r?.associated_user?.email],["locale",r?.associated_user?.locale],["emailVerified",r?.associated_user?.email_verified],["accountOwner",r?.associated_user?.account_owner],["collaborator",r?.associated_user?.collaborator]];default:return[[t,r]]}}).filter(([e,t])=>void 0!==t)}}var tN=r(4573);let tj=new TextEncoder,tM=new TextDecoder,tq=e=>new Uint8Array(tN.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=tM.decode(t)),t}(e),"base64url"));var tH=r(7598),tL=r(7975);class tJ extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class tK extends tJ{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class tW extends tJ{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class tF extends tJ{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class tV extends tJ{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class tX extends tJ{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class tB extends tJ{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class tz extends tJ{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class tG extends tJ{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function tQ(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"EdDSA":return;default:throw new tV(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let tY=tH.webcrypto,tZ=e=>tL.types.isCryptoKey(e),t0=e=>tL.types.isKeyObject(e);function t1(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let t2=(e,...t)=>t1("Key must be ",e,...t);function t4(e,t,...r){return t1(`Key for the ${e} algorithm must be `,t,...r)}let t5=e=>t0(e)||tZ(e),t3=["KeyObject"];function t6(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function t8(e){return t6(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||tY?.CryptoKey)&&t3.push("CryptoKey"),new WeakMap;let t9=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new tV("Unsupported key curve for this operation")}},t7=(e,t)=>{let r;if(tZ(e))r=tH.KeyObject.from(e);else if(t0(e))r=e;else if(t8(e))return e.crv;else throw TypeError(t2(e,...t3));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return t9(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}},re=(e,t)=>{let r;try{r=e instanceof tH.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},rt=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function rr(e,t){let r,n,i,s;if(t instanceof tH.KeyObject)r=t.asymmetricKeyType,n=t.asymmetricKeyDetails;else switch(i=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");re(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:i}=n,s=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${s}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==i&&i>s>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");re(t,e),s={padding:tH.constants.RSA_PKCS1_PSS_PADDING,saltLength:tH.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let n=t7(t),i=rt.get(e);if(n!==i)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${i}, got ${n}`);s={dsaEncoding:"ieee-p1363"};break}default:throw new tV(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return i?{format:"jwk",key:t,...s}:s?{...s,key:t}:t}function rn(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function ri(e,t){return e.name===t}function rs(e){return parseInt(e.name.slice(4),10)}function ro(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(t2(t,...t3));return(0,tH.createSecretKey)(t)}if(t instanceof tH.KeyObject)return t;if(tZ(t))return function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!ri(e.algorithm,"HMAC"))throw rn("HMAC");let r=parseInt(t.slice(2),10);if(rs(e.algorithm.hash)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ri(e.algorithm,"RSASSA-PKCS1-v1_5"))throw rn("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(rs(e.algorithm.hash)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ri(e.algorithm,"RSA-PSS"))throw rn("RSA-PSS");let r=parseInt(t.slice(2),10);if(rs(e.algorithm.hash)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw rn("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!ri(e.algorithm,"ECDSA"))throw rn("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw rn(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}(function(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}})(e,r)}(t,e,r),tH.KeyObject.from(t);if(t8(t))return e.startsWith("HS")?(0,tH.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(t2(t,...t3,"Uint8Array","JSON Web Key"))}let ra=(0,tL.promisify)(tH.sign),rc=async(e,t,r)=>{let n=ro(e,t,"sign");if(e.startsWith("HS")){let t=tH.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new tV(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),n);return t.update(r),t.digest()}return ra(tQ(e),r,rr(e,n))},rl=(0,tL.promisify)(tH.verify),ru=async(e,t,r,n)=>{let i=ro(e,t,"verify");if(e.startsWith("HS")){let t=await rc(e,i,n);try{return tH.timingSafeEqual(r,t)}catch{return!1}}let s=tQ(e),o=rr(e,i);try{return await rl(s,n,o,r)}catch{return!1}},rp=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},rd=e=>e?.[Symbol.toStringTag],rh=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},rf=(e,t,r,n)=>{if(!(t instanceof Uint8Array)){if(n&&t8(t)){if(function(e){return t8(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&rh(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!t5(t))throw TypeError(t4(e,t,...t3,"Uint8Array",n?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${rd(t)} instances for symmetric algorithms must be of type "secret"`)}},rm=(e,t,r,n)=>{if(n&&t8(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&rh(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&rh(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!t5(t))throw TypeError(t4(e,t,...t3,n?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${rd(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${rd(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${rd(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${rd(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${rd(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function ry(e,t,r,n){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?rf(t,r,n,e):rm(t,r,n,e)}ry.bind(void 0,!1);let rg=ry.bind(void 0,!0),rw=function(e,t,r,n,i){let s;if(void 0!==i.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let o of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!s.has(o))throw new tV(`Extension Header Parameter "${o}" is not recognized`);if(void 0===i[o])throw new e(`Extension Header Parameter "${o}" is missing`);if(s.get(o)&&void 0===n[o])throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(n.crit)},rb=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)},rS=e=>e.d?(0,tH.createPrivateKey)({format:"jwk",key:e}):(0,tH.createPublicKey)({format:"jwk",key:e});async function rA(e,t){if(!t6(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return tq(e.k);case"RSA":if(void 0!==e.oth)throw new tV('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return rS({...e,alg:t});default:throw new tV('Unsupported "kty" (Key Type) Parameter value')}}async function rv(e,t,r){let n,i;if(!t6(e))throw new tX("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new tX('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new tX("JWS Protected Header incorrect type");if(void 0===e.payload)throw new tX("JWS Payload missing");if("string"!=typeof e.signature)throw new tX("JWS Signature missing or incorrect type");if(void 0!==e.header&&!t6(e.header))throw new tX("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{let t=tq(e.protected);s=JSON.parse(tM.decode(t))}catch{throw new tX("JWS Protected Header is invalid")}if(!rp(s,e.header))throw new tX("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...s,...e.header},a=rw(tX,new Map([["b64",!0]]),r?.crit,s,o),c=!0;if(a.has("b64")&&"boolean"!=typeof(c=s.b64))throw new tX('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=o;if("string"!=typeof l||!l)throw new tX('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&rb("algorithms",r.algorithms);if(u&&!u.has(l))throw new tF('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new tX("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new tX("JWS Payload must be a string or an Uint8Array instance");let p=!1;"function"==typeof t?(t=await t(s,e),p=!0,rg(l,t,"verify"),t8(t)&&(t=await rA(t,l))):rg(l,t,"verify");let d=function(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}(tj.encode(e.protected??""),tj.encode("."),"string"==typeof e.payload?tj.encode(e.payload):e.payload);try{n=tq(e.signature)}catch{throw new tX("Failed to base64url decode the signature")}if(!await ru(l,t,n,d))throw new tG;if(c)try{i=tq(e.payload)}catch{throw new tX("Failed to base64url decode the payload")}else i="string"==typeof e.payload?tj.encode(e.payload):e.payload;let h={payload:i};return(void 0!==e.protected&&(h.protectedHeader=s),void 0!==e.header&&(h.unprotectedHeader=e.header),p)?{...h,key:t}:h}async function rE(e,t,r){if(e instanceof Uint8Array&&(e=tM.decode(e)),"string"!=typeof e)throw new tX("Compact JWS must be a string or Uint8Array");let{0:n,1:i,2:s,length:o}=e.split(".");if(3!==o)throw new tX("Invalid Compact JWS");let a=await rv({payload:i,protected:n,signature:s},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return"function"==typeof t?{...c,key:a.key}:c}let rk=e=>Math.floor(e.getTime()/1e3),rT=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,rC=e=>{let t;let r=rT.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(0x1e187e0*n)}return"-"===r[1]||"ago"===r[4]?-t:t},r$=e=>e.toLowerCase().replace(/^application\//,""),rI=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),rP=(e,t,r={})=>{let n,i;try{n=JSON.parse(tM.decode(t))}catch{}if(!t6(n))throw new tB("JWT Claims Set must be a top-level JSON object");let{typ:s}=r;if(s&&("string"!=typeof e.typ||r$(e.typ)!==r$(s)))throw new tK('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:o=[],issuer:a,subject:c,audience:l,maxTokenAge:u}=r,p=[...o];for(let e of(void 0!==u&&p.push("iat"),void 0!==l&&p.push("aud"),void 0!==c&&p.push("sub"),void 0!==a&&p.push("iss"),new Set(p.reverse())))if(!(e in n))throw new tK(`missing required "${e}" claim`,n,e,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(n.iss))throw new tK('unexpected "iss" claim value',n,"iss","check_failed");if(c&&n.sub!==c)throw new tK('unexpected "sub" claim value',n,"sub","check_failed");if(l&&!rI(n.aud,"string"==typeof l?[l]:l))throw new tK('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof r.clockTolerance){case"string":i=rC(r.clockTolerance);break;case"number":i=r.clockTolerance;break;case"undefined":i=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:d}=r,h=rk(d||new Date);if((void 0!==n.iat||u)&&"number"!=typeof n.iat)throw new tK('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new tK('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>h+i)throw new tK('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new tK('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=h-i)throw new tW('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){let e=h-n.iat;if(e-i>("number"==typeof u?u:rC(u)))throw new tW('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-i)throw new tK('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function rO(e,t,r){let n=await rE(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new tB("JWTs MUST NOT use unencoded payload");let i={payload:rP(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...i,key:n.key}:i}function rR(e){return async(t,{checkAudience:r=!0}={})=>{let n;try{n=(await rO(t,function(e){let t=new Uint8Array(e.length);for(let r=0,n=e.length;r<n;r++)t[r]=e.charCodeAt(r);return t}(e.apiSecretKey),{algorithms:["HS256"],clockTolerance:10})).payload}catch(e){throw new R(`Failed to parse session token '${t}': ${e.message}`)}if(r&&n.aud!==e.apiKey)throw new R("Session token had invalid API key");return n}}function rx(e,t,r){let n=e.split(t),i=Math.min(Math.abs(r),n.length);return[...n.slice(0,i-1),n.slice(i-1).join(t)]}class r_{response;static parseCookies(e){let t=Object.fromEntries(e.filter(e=>e.trim().length>0).map(e=>{let[t,...r]=e.split(";"),[n,i]=rx(t,"=",2).map(e=>e.trim());return[n,{name:n,value:i,...Object.fromEntries(r.map(e=>rx(e,"=",2).map(e=>e.trim())))}]}));for(let e of Object.values(t))"string"==typeof e.expires&&(e.expires=new Date(e.expires));return t}static encodeCookie(e){let t="";return t+=`${e.name}=${e.value};`,t+=Object.entries(e).filter(([e])=>!["name","value","expires"].includes(e)).map(([e,t])=>`${e}=${t}`).join("; "),e.expires&&(t+=";",t+=`expires=${e.expires.toUTCString()}`),t}receivedCookieJar={};outgoingCookieJar={};keys=[];constructor(e,t,{keys:r=[]}={}){this.response=t,r&&(this.keys=r);let n=(0,e5._b)(e.headers,"Cookie")??"";this.receivedCookieJar=r_.parseCookies(n.split(";"));let i=(0,e5.dJ)(t.headers,"Set-Cookie")??[];this.outgoingCookieJar=r_.parseCookies(i)}toHeaders(){return Object.values(this.outgoingCookieJar).map(e=>r_.encodeCookie(e))}updateHeader(){this.response.headers||(this.response.headers={}),(0,e5.k9)(this.response.headers,"Set-Cookie"),this.toHeaders().map(e=>(0,e5.NI)(this.response.headers,"Set-Cookie",e))}get(e){return this.receivedCookieJar[e]?.value}deleteCookie(e){this.set(e,"",{path:"/",expires:new Date(0)})}async getAndVerify(e){let t=this.get(e);if(t){if(!await this.isSignedCookieValid(e))return;return t}}get canSign(){return this.keys?.length>0}set(e,t,r={}){this.outgoingCookieJar[e]={...r,name:e,value:t},this.updateHeader()}async setAndSign(e,t,r={}){if(!this.canSign)throw Error("No keys provided for signing.");this.set(e,t,r);let n=`${e}.sig`,i=await te(this.keys[0],t);this.set(n,i,r),this.updateHeader()}async isSignedCookieValid(e){let t=`${e}.sig`;if(!this.cookieExists(e)||!this.cookieExists(t))return this.deleteInvalidCookies(e,t),!1;let r=this.get(e),n=this.get(t);return!!(r&&n&&(await Promise.all(this.keys.map(e=>te(e,r)))).includes(n))||(this.deleteInvalidCookies(e,t),!1)}cookieExists(e){return!!this.get(e)}deleteInvalidCookies(...e){e.forEach(e=>this.deleteCookie(e))}}function rD(e){return(t,r)=>`${tv(e)(t,!0)}_${r}`}function rU(e){return t=>`offline_${tv(e)(t,!0)}`}function rN({config:e,accessTokenResponse:t,shop:r,state:n}){let i=!!t.associated_user;if(ee(e).info("Creating new session",{shop:r,isOnline:i}),!i)return new tU({id:rU(e)(r),shop:r,state:n,isOnline:i,accessToken:t.access_token,scope:t.scope});{let{access_token:s,scope:o,...a}=t,c=new Date(Date.now()+1e3*t.expires_in);return new tU({id:e.isEmbeddedApp?rD(e)(r,`${a.associated_user.id}`):t_(),shop:r,state:n,isOnline:i,accessToken:s,scope:o,expires:c,onlineAccessInfo:a})}}let rj=({request:e,log:t,func:r})=>{t.debug(`Possible bot request to auth ${r}: `,{userAgent:e.headers["User-Agent"]})};async function rM({config:e,query:t,stateFromCookie:r}){return await tf(e)(t)&&td(t.state,r)}function rq(e,t){if(e)throw new U(t)}function rH(e){return t=>{tE()(t,!0);let r=atob(t);return`https://${r}/apps/${e.apiKey}`}}function rL(e){return(t,r=e.apiVersion)=>{if(r===er.Unstable)return!0;let n=e=>parseInt(e.replace("-",""),10);return n(r)>=n(t)}}(function(e){e.OnlineAccessToken="urn:shopify:params:oauth:token-type:online-access-token",e.OfflineAccessToken="urn:shopify:params:oauth:token-type:offline-access-token"})(ep||(ep={})),function(e){e.Http="http",e.EventBridge="eventbridge",e.PubSub="pubsub"}(ed||(ed={})),function(e){e.Create="create",e.Update="update",e.Delete="delete"}(eh||(eh={}));let rJ={...th,MissingHeaders:"missing_headers"};function rK(e){return e.toUpperCase().replace(/\/|\./g,"_")}function rW(e){return function(t){return e[rK(t)]||[]}}function rF(e,t){let r=t.deliveryMethod;switch(t.deliveryMethod){case ed.Http:return`${r}_${rV(e,t.callbackUrl)}`;case ed.EventBridge:return`${r}_${t.arn}`;case ed.PubSub:return`${r}_${t.pubSubProject}:${t.pubSubTopic}`;default:throw new _(`Unrecognized delivery method '${t.deliveryMethod}'`)}}function rV(e,t){return t.startsWith("/")?`${e.hostScheme}://${e.hostName}${t}`:t}function rX(e,t,r,n){let i=ee(e);if(n.includeFields?.sort(),n.metafieldNamespaces?.sort(),!(r in t)){t[r]=[n];return}let s=rF(e,n);for(let o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&s===rF(e,t[r][o])){if(n.deliveryMethod===ed.Http){i.info(`Detected multiple handlers for '${r}', webhooks.process will call them sequentially`);break}throw new _(`Can only add multiple handlers for a topic when deliveryMethod is Http. Please be sure that you used addHandler method once after creating ShopifyApi instance in your app.  Invalid handler: ${JSON.stringify(n)}`)}t[r].push(n)}function rB(e,t){let r=e;return Object.entries(t).forEach(([e,t])=>{r=r.replace(`{{${e}}}`,t)}),r}async function rz(e,t){let r;let n=new(e7({config:e}))({session:t}),i={},s=null;do{let e=rB(r2,{END_CURSOR:JSON.stringify(s)}),t=await n.request(e);t.data?.webhookSubscriptions?.edges.forEach(e=>{let t=function(e){let t;let r=e.node.endpoint;switch(r.__typename){case"WebhookHttpEndpoint":t={deliveryMethod:ed.Http,callbackUrl:r.callbackUrl,callback:async()=>{}};break;case"WebhookEventBridgeEndpoint":t={deliveryMethod:ed.EventBridge,arn:r.arn};break;case"WebhookPubSubEndpoint":t={deliveryMethod:ed.PubSub,pubSubProject:r.pubSubProject,pubSubTopic:r.pubSubTopic}}return t.id=e.node.id,t.includeFields=e.node.includeFields,t.metafieldNamespaces=e.node.metafieldNamespaces,t.includeFields?.sort(),t.metafieldNamespaces?.sort(),t}(e);i[e.node.topic]||(i[e.node.topic]=[]),i[e.node.topic].push(t)}),s=t.data?.webhookSubscriptions?.pageInfo.endCursor,r=t.data?.webhookSubscriptions?.pageInfo.hasNextPage}while(r);return i}async function rG({config:e,session:t,topic:r,existingHandlers:n,handlers:i}){let s=[],{toCreate:o,toUpdate:a,toDelete:c}=function(e,t,r){let n=r.reduce((t,r)=>(t[rF(e,r)]=r,t),{}),i=t.reduce((t,r)=>(t[rF(e,r)]=r,t),{}),s={...n},o={},a={};for(let e in i){if(!Object.prototype.hasOwnProperty.call(i,e))continue;let t=i[e],r=n[e];e in n?(delete s[e],!function(e,t){let r=rQ(e.includeFields||[],t.includeFields||[]),n=rQ(e.metafieldNamespaces||[],t.metafieldNamespaces||[]);return r&&n}(t,r)&&(o[e]=r,o[e].id=t.id)):a[e]=t}return{toCreate:Object.values(s),toUpdate:Object.values(o),toDelete:Object.values(a)}}(e,n,i),l=new(e7({config:e}))({session:t}),u=eh.Create;return s=s.concat(await rY({config:e,client:l,topic:r,operation:u,handlers:o})),u=eh.Update,s=s.concat(await rY({config:e,client:l,topic:r,operation:u,handlers:a})),u=eh.Delete,s=s.concat(await rY({config:e,client:l,topic:r,operation:u,handlers:c}))}function rQ(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}async function rY({config:e,client:t,topic:r,handlers:n,operation:i}){let s=[];for(let o of n)s.push(await rZ({config:e,client:t,topic:r,handler:o,operation:i}));return s}async function rZ({config:e,client:t,topic:r,handler:n,operation:i}){let s;ee(e).debug("Running webhook mutation",{topic:r,operation:i});try{let o=function(e,t,r,n){let i;let s={};i=r.id?`id: "${r.id}"`:`topic: ${t}`;let o={MUTATION_NAME:r0(r,n),IDENTIFIER:i,MUTATION_PARAMS:""};if(n!==eh.Delete){switch(r.deliveryMethod){case ed.Http:s.callbackUrl=`"${rV(e,r.callbackUrl)}"`;break;case ed.EventBridge:s.arn=`"${r.arn}"`;break;case ed.PubSub:s.pubSubProject=`"${r.pubSubProject}"`,s.pubSubTopic=`"${r.pubSubTopic}"`;break;default:throw new _(`Unrecognized delivery method '${r.deliveryMethod}'`)}if(r.includeFields&&(s.includeFields=JSON.stringify(r.includeFields)),r.metafieldNamespaces&&(s.metafieldNamespaces=JSON.stringify(r.metafieldNamespaces)),r.subTopic){let e=`subTopic: "${r.subTopic}",`;o.MUTATION_PARAMS=e}let t=Object.entries(s).map(([e,t])=>`${e}: ${t}`).join(", ");o.MUTATION_PARAMS+=`webhookSubscription: {${t}}`}return rB(r4,o)}(e,r,n,i),a=await t.request(o);s={deliveryMethod:n.deliveryMethod,success:function(e,t,r){let n=r0(t,r);return!!(e.data&&e.data[n]&&0===e.data[n].userErrors.length)}(a,n,i),result:a,operation:i}}catch(e){if(e instanceof _)s={deliveryMethod:n.deliveryMethod,success:!1,result:{message:e.message},operation:i};else throw e}return s}function r0(e,t){switch(t){case eh.Create:return`${r1(e)}Create`;case eh.Update:return`${r1(e)}Update`;case eh.Delete:return"webhookSubscriptionDelete";default:throw new $(`Unrecognized operation '${t}'`)}}function r1(e){switch(e.deliveryMethod){case ed.Http:return"webhookSubscription";case ed.EventBridge:return"eventBridgeWebhookSubscription";case ed.PubSub:return"pubSubWebhookSubscription";default:throw new $(`Unrecognized delivery method '${e.deliveryMethod}'`)}}let r2=`query shopifyApiReadWebhookSubscriptions {
  webhookSubscriptions(
    first: 250,
    after: {{END_CURSOR}},
  ) {
    edges {
      node {
        id
        topic
        includeFields
        metafieldNamespaces
        endpoint {
          __typename
          ... on WebhookHttpEndpoint {
            callbackUrl
          }
          ... on WebhookEventBridgeEndpoint {
            arn
          }
          ... on WebhookPubSubEndpoint {
            pubSubProject
            pubSubTopic
          }
        }
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}`,r4=`
  mutation shopifyApiCreateWebhookSubscription {
    {{MUTATION_NAME}}(
      {{IDENTIFIER}},
      {{MUTATION_PARAMS}}
    ) {
      userErrors {
        field
        message
      }
    }
  }
`,r5={subTopic:en.SubTopic},r3={apiVersion:en.ApiVersion,domain:en.Domain,hmac:en.Hmac,topic:en.Topic,webhookId:en.WebhookId,...r5};function r6(e){return async function({rawBody:t,...r}){let n=await (0,e1.ph)(r),i=await ty(e)({type:el.Webhook,rawBody:t,...r});if(!i.valid){if(i.reason===th.InvalidHmac){let t=ee(e);await t.debug("Webhook HMAC validation failed. Please note that events manually triggered from a store's Notifications settings will fail this validation. To test this, please use the CLI or trigger the actual event in a development store.")}return i}return function(e){let t=[],r=Object.entries(r3).reduce((r,[n,i])=>{let s=(0,e5._b)(e,i);return s?r[n]=s:n in r5||t.push(i),r},{});return t.length?{valid:!1,reason:rJ.MissingHeaders,missingHeaders:t}:{valid:!0,...r,...r.subTopic?{subTopic:r.subTopic}:{},topic:rK(r.topic)}}(n.headers)}}let r8={[i.Ok]:"OK",[i.BadRequest]:"Bad Request",[i.Unauthorized]:"Unauthorized",[i.NotFound]:"Not Found",[i.InternalServerError]:"Internal Server Error"};async function r9(e,t,r,n,s){let o=ee(e),{hmac:a,valid:c,...l}=r;await o.debug("Webhook request is valid, looking for HTTP handlers to call",l);let u=t[r.topic]||[],p={statusCode:i.Ok},d=!1;for(let e of u)if(e.deliveryMethod===ed.Http){if(!e.callback)throw p.statusCode=i.InternalServerError,p.errorMessage="Cannot call webhooks.process with a webhook handler that doesn't have a callback",new B({message:p.errorMessage,response:p});d=!0,await o.debug("Found HTTP handler, triggering it",l);try{await e.callback(r.topic,r.domain,n,r.webhookId,r.apiVersion,...r?.subTopic?r.subTopic:"",s)}catch(e){p.statusCode=i.InternalServerError,p.errorMessage=e.message}}return d||(await o.debug("No HTTP handlers found",l),p.statusCode=i.NotFound,p.errorMessage=`No HTTP webhooks registered for topic ${r.topic}`),p}async function r7(e,t){let r={statusCode:i.InternalServerError,errorMessage:"Unknown error while handling webhook"};switch(t.reason){case rJ.MissingHeaders:r.statusCode=i.BadRequest,r.errorMessage=`Missing one or more of the required HTTP headers to process webhooks: [${t.missingHeaders.join(", ")}]`;break;case rJ.MissingBody:r.statusCode=i.BadRequest,r.errorMessage="No body was received when processing webhook";break;case rJ.MissingHmac:r.statusCode=i.BadRequest,r.errorMessage="Missing HMAC header in request";break;case rJ.InvalidHmac:r.statusCode=i.Unauthorized,r.errorMessage="Could not validate request HMAC"}return await ee(e).debug(`Webhook request is invalid, returning ${r.statusCode}: ${r.errorMessage}`),r}async function ne({client:e,isTest:t,plans:r}){let n;let i={hasActivePayment:!1,oneTimePurchases:[],appSubscriptions:[]},s=null;do{let o=await e.request(nt,{variables:{endCursor:s}});(n=o.data?.currentAppInstallation).activeSubscriptions.forEach(e=>{(function({subscription:e,isTest:t,plans:r}){return(void 0===r||r.includes(e.name))&&(t||!e.test)})({subscription:e,isTest:t,plans:r})&&(i.hasActivePayment=!0,i.appSubscriptions.push(e))}),n.oneTimePurchases.edges.forEach(({node:e})=>{(function({purchase:e,isTest:t,plans:r}){return(void 0===r||r.includes(e.name))&&(t||!e.test)&&"ACTIVE"===e.status})({purchase:e,isTest:t,plans:r})&&(i.hasActivePayment=!0,i.oneTimePurchases.push(e))}),s=n.oneTimePurchases.pageInfo.endCursor}while(n?.oneTimePurchases.pageInfo.hasNextPage);return i}let nt=`
  query appSubscription($endCursor: String) {
    currentAppInstallation {
      activeSubscriptions {
        id
        name
        test
        status
        lineItems {
          id
          plan {
            pricingDetails {
              ... on AppRecurringPricing {
                price {
                  amount
                  currencyCode
                }
                interval
                discount {
                  durationLimitInIntervals
                  remainingDurationInIntervals
                  priceAfterDiscount {
                    amount
                  }
                  value {
                    ... on AppSubscriptionDiscountAmount {
                      amount {
                        amount
                        currencyCode
                      }
                    }
                    ... on AppSubscriptionDiscountPercentage {
                      percentage
                    }
                  }
                }
              }
              ... on AppUsagePricing {
                balanceUsed {
                  amount
                  currencyCode
                }
                cappedAmount {
                  amount
                  currencyCode
                }
                terms
              }
            }
          }
        }
      }
      oneTimePurchases(first: 250, sortKey: CREATED_AT, after: $endCursor) {
        edges {
          node {
            id
            name
            test
            status
          }
        }
        pageInfo {
          hasNextPage
          endCursor
        }
      }
    }
  }
`;async function nr({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:i}){let s=e.lineItems.map(e=>{if(e.interval===es.Every30Days||e.interval===es.Annual){let t={interval:e.interval,price:{amount:e.amount,currencyCode:e.currencyCode}};return e.discount&&(t.discount={durationLimitInIntervals:e.discount.durationLimitInIntervals,value:{amount:e.discount.value.amount,percentage:e.discount.value.percentage}}),{plan:{appRecurringPricingDetails:t}}}if(e.interval===es.Usage)return{plan:{appUsagePricingDetails:{terms:e.terms,cappedAmount:{amount:e.amount,currencyCode:e.currencyCode}}}};throw new Q({message:"Invalid interval provided",errorData:[e]})}),o=await r.request(no,{variables:{name:t,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,returnUrl:n,test:i,lineItems:s}});if(o.errors)throw new Q({message:"Error while billing the store",errorData:o.errors});return o.data}async function nn({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:i}){let s=await r.request(no,{variables:{name:t,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,returnUrl:n,test:i,lineItems:[{plan:{appRecurringPricingDetails:{interval:e.interval,price:{amount:e.amount,currencyCode:e.currencyCode},discount:{durationLimitInIntervals:e.discount?.durationLimitInIntervals,value:{amount:e.discount?.value?.amount,percentage:e.discount?.value?.percentage}}}}}]}});if(s.errors)throw new Q({message:"Error while billing the store",errorData:s.errors});return s.data}async function ni({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:i}){let s=await r.request(no,{variables:{name:t,returnUrl:n,test:i,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,lineItems:[{plan:{appUsagePricingDetails:{terms:e.usageTerms,cappedAmount:{amount:e.amount,currencyCode:e.currencyCode}}}}]}});if(s.errors)throw new Q({message:`Error while billing the store:: ${s.errors}`,errorData:s.errors});return s.data}async function ns({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:i}){let s=await r.request(na,{variables:{name:t,returnUrl:n,test:i,price:{amount:e.amount,currencyCode:e.currencyCode}}});if(s.errors)throw new Q({message:"Error while billing the store",errorData:s.errors});return s.data}let no=`
  mutation test(
    $name: String!
    $lineItems: [AppSubscriptionLineItemInput!]!
    $returnUrl: URL!
    $test: Boolean
    $trialDays: Int
    $replacementBehavior: AppSubscriptionReplacementBehavior
  ) {
    appSubscriptionCreate(
      name: $name
      lineItems: $lineItems
      returnUrl: $returnUrl
      test: $test
      trialDays: $trialDays
      replacementBehavior: $replacementBehavior
    ) {
      appSubscription {
        id
        name
        test
      }
      confirmationUrl
      userErrors {
        field
        message
      }
    }
  }
`,na=`
  mutation test(
    $name: String!
    $price: MoneyInput!
    $returnUrl: URL!
    $test: Boolean
  ) {
    appPurchaseOneTimeCreate(
      name: $name
      price: $price
      returnUrl: $returnUrl
      test: $test
    ) {
      appPurchaseOneTime {
        id
        name
        test
      }
      confirmationUrl
      userErrors {
        field
        message
      }
    }
  }
`,nc=`
  mutation appSubscriptionCancel($id: ID!, $prorate: Boolean) {
    appSubscriptionCancel(id: $id, prorate: $prorate) {
      appSubscription {
        id
        name
        test
      }
      userErrors {
        field
        message
      }
    }
  }
`,nl=`
query appSubscription {
  currentAppInstallation {
    activeSubscriptions {
      id
      name
      test
      lineItems {
        id
        plan {
          pricingDetails {
            ... on AppRecurringPricing {
              price {
                amount
                currencyCode
              }
              interval
              discount {
                durationLimitInIntervals
                remainingDurationInIntervals
                priceAfterDiscount {
                  amount
                }
                value {
                  ... on AppSubscriptionDiscountAmount {
                    amount {
                      amount
                      currencyCode
                    }
                  }
                  ... on AppSubscriptionDiscountPercentage {
                    percentage
                  }
                }
              }
            }
            ... on AppUsagePricing {
              balanceUsed {
                amount
                currencyCode
              }
              cappedAmount {
                amount
                currencyCode
              }
              terms
            }
          }
        }
      }
    }
  }
}
`,nu=`
mutation appUsageRecordCreate($description: String!, $price: MoneyInput!, $subscriptionLineItemId: ID!) {
  appUsageRecordCreate(description: $description, price: $price, subscriptionLineItemId: $subscriptionLineItemId) {
    userErrors {
      field
      message
    }
    appUsageRecord {
      id
      description
      idempotencyKey
      price {
        amount
        currencyCode
      }
      subscriptionLineItem {
        id
        plan {
          pricingDetails {
            ... on AppUsagePricing {
              balanceUsed {
                amount
                currencyCode
              }
              cappedAmount {
                amount
                currencyCode
              }
              terms
            }
          }
        }
      }
    }
  }
}
`;async function np({client:e,isTest:t}){let r=await ne({client:e,isTest:t});if(!r.hasActivePayment)throw new Q({message:"No active payment found",errorData:[]});if(!r.appSubscriptions.length)throw new Q({message:"No active subscriptions found",errorData:[]});if(r.appSubscriptions)return function(e){for(let t of e)if("ACTIVE"===t.status&&t.lineItems){for(let e of t.lineItems)if("balanceUsed"in e.plan.pricingDetails)return e.id}throw new Q({message:"No active usage subscription found",errorData:[]})}(r.appSubscriptions);throw new Q({message:"Unable to find active subscription line item",errorData:[]})}let nd=`
mutation appSubscriptionLineItemUpdate($cappedAmount: MoneyInput!, $id: ID!) {
  appSubscriptionLineItemUpdate(cappedAmount: $cappedAmount, id: $id) {
    userErrors {
      field
      message
    }
    confirmationUrl
    appSubscription {
      id
      name
      test
      lineItems {
        id
        plan {
          pricingDetails {
            ... on AppUsagePricing {
              balanceUsed {
                amount
                currencyCode
              }
              cappedAmount {
                amount
                currencyCode
              }
              terms
            }
          }
        }
      }
    }
  }
}
`;function nh({future:e,restResources:t,...r}){var n;let s=function(e){let t;let r={apiKey:"",apiSecretKey:"",hostName:"",hostScheme:"https",apiVersion:T,isEmbeddedApp:!0,isCustomStoreApp:!1,logger:{log:ey,level:et.Info,httpRequests:!1,timestamps:!1},future:{},_logDisabledFutureFlags:!0},n=["apiSecretKey","hostName"];"isCustomStoreApp"in e&&e.isCustomStoreApp||n.push("apiKey"),"isCustomStoreApp"in e&&e.isCustomStoreApp&&(!("adminApiAccessToken"in e)||e.adminApiAccessToken?.length===0)&&n.push("adminApiAccessToken");let i=[];if(n.forEach(t=>{var r;null!=(r=e[t])&&(!("string"==typeof r||Array.isArray(r))||r.length>0)||i.push(t)}),i.length)throw new $(`Cannot initialize Shopify API Library. Missing values for: ${i.join(", ")}`);let s=e.future?.v10_lineItemBilling?{lineItemBilling:e.future?.v10_lineItemBilling,...e.future}:e.future,{hostScheme:o,isCustomStoreApp:a,adminApiAccessToken:c,userAgentPrefix:l,logger:u,privateAppStorefrontAccessToken:p,customShopDomains:d,billing:h,...f}=e;return t=void 0===e.scopes?void 0:e.scopes instanceof em?e.scopes:new em(e.scopes),Object.assign(r,f,{hostName:e.hostName.replace(/\/$/,""),scopes:t,hostScheme:o??r.hostScheme,isCustomStoreApp:a??r.isCustomStoreApp,adminApiAccessToken:c??r.adminApiAccessToken,userAgentPrefix:l??r.userAgentPrefix,logger:{...r.logger,...u||{}},privateAppStorefrontAccessToken:p??r.privateAppStorefrontAccessToken,customShopDomains:d??r.customShopDomains,billing:h??r.billing,future:s??r.future}),r.isCustomStoreApp&&e.adminApiAccessToken===e.apiSecretKey&&ee(r).warning("adminApiAccessToken is set to the same value as apiSecretKey. adminApiAccessToken should be set to the Admin API access token for custom store apps; apiSecretKey should be set to the custom store app's API secret key."),r}({...r,future:e,restResources:t}),o={config:s,clients:{Rest:ts({config:s}),Graphql:e7({config:s}),Storefront:function(e){let{config:t}=e;class r extends tc{static config=t}return Reflect.defineProperty(r,"name",{value:"StorefrontClient"}),r}({config:s}),graphqlProxy:async({session:e,rawBody:t})=>{let r,n;if(!e.accessToken)throw new V("Cannot proxy query. Session not authenticated.");let i=new(e7({config:s}))({session:e});if("string"==typeof t?r=t:(r=t.query,n=t.variables),!r)throw new z("Query missing.");return{body:await i.request(r,{variables:n}),headers:{}}}},auth:{begin:async({shop:e,callbackPath:t,isOnline:r,...n})=>{rq(s.isCustomStoreApp,"Cannot perform OAuth for private apps");let i=ee(s);i.info("Beginning OAuth",{shop:e,isOnline:r,callbackPath:t});let o=await (0,e1.ph)(n),a=await (0,e1.RK)(n),c=o.headers["User-Agent"];if(Array.isArray(c)&&(c=c[0]),tu(c))return rj({request:o,log:i,func:"begin"}),a.statusCode=410,(0,e1.d4)(a,n);let l=new r_(o,a,{keys:[s.apiSecretKey],secure:!0}),u=t$();await l.setAndSign(tC,u,{expires:new Date(Date.now()+6e4),sameSite:"lax",secure:!0,path:t});let p=s.scopes?s.scopes.toString():"",d={client_id:s.apiKey,scope:p,redirect_uri:`${s.hostScheme}://${s.hostName}${t}`,state:u,"grant_options[]":r?"per-user":""},h=new tp;h.putAll(d);let f=tv(s)(e,!0),m=`https://${f}/admin/oauth/authorize${h.stringify()}`;return a.statusCode=302,a.statusText="Found",a.headers={...a.headers,...l.response.headers,Location:m},i.debug(`OAuth started, redirecting to ${m}`,{shop:e,isOnline:r}),(0,e1.d4)(a,n)},callback:async function({...e}){rq(s.isCustomStoreApp,"Cannot perform OAuth for private apps");let t=ee(s),r=await (0,e1.ph)(e),n=new URL(r.url,`${s.hostScheme}://${s.hostName}`).searchParams,i=n.get("shop"),o=r.headers["User-Agent"];if(Array.isArray(o)&&(o=o[0]),tu(o))throw rj({request:r,log:t,func:"callback"}),new W("Invalid OAuth callback initiated by bot");t.info("Completing OAuth",{shop:i});let a=new r_(r,{},{keys:[s.apiSecretKey],secure:!0}),c=await a.getAndVerify(tC);if(a.deleteCookie(tC),!c)throw t.error("Could not find OAuth cookie",{shop:i}),new F(`Cannot complete OAuth process. Could not find an OAuth cookie for shop url: ${i}`);let l=Object.fromEntries(n.entries());if(!await rM({config:s,query:l,stateFromCookie:c}))throw t.error("Invalid OAuth callback",{shop:i,stateFromCookie:c}),new K("Invalid OAuth callback.");t.debug("OAuth request is valid, requesting access token",{shop:i});let u={client_id:s.apiKey,client_secret:s.apiSecretKey,code:n.get("code")},p=tv(s)(n.get("shop"),!0),d=await tk(s)(`https://${p}/admin/oauth/access_token`,{method:"POST",body:JSON.stringify(u),headers:{"Content-Type":eu.JSON,Accept:eu.JSON}});d.ok||e8(await d.json(),!1,d);let h=rN({accessTokenResponse:await d.json(),shop:p,state:c,config:s});return s.isEmbeddedApp||await a.setAndSign(tT,h.id,{expires:h.expires,sameSite:"lax",secure:!0,path:"/"}),{headers:await (0,e1.s$)(a.response.headers,e),session:h}},nonce:t$,safeCompare:td,getEmbeddedAppUrl:async({...e})=>{let t=await (0,e1.ph)(e);if(!t)throw new z("getEmbeddedAppUrl requires a request object argument");if(!t.url)throw new G("Request does not contain a URL");let r=new URL(t.url,`https://${t.headers.host}`).searchParams.get("host");if("string"!=typeof r)throw new G("Request does not contain a host query parameter");return rH(s)(r)},buildEmbeddedAppUrl:rH(s),tokenExchange:async({shop:e,sessionToken:t,requestedTokenType:r})=>{await rR(s)(t);let n={client_id:s.apiKey,client_secret:s.apiSecretKey,grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:t,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",requested_token_type:r},i=tv(s)(e,!0),o=await tk(s)(`https://${i}/admin/oauth/access_token`,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":eu.JSON,Accept:eu.JSON}});return o.ok||e8(await o.json(),!1,o),{session:rN({accessTokenResponse:await o.json(),shop:i,state:"",config:s})}}},session:{customAppSession:e=>new tU({id:"",shop:`${tv(s)(e,!0)}`,state:"",isOnline:!1}),getCurrentId:async function({isOnline:e,...t}){let r=await (0,e1.ph)(t),n=ee(s);if(!s.isEmbeddedApp)return n.debug("App is not embedded, looking for session id in cookies",{isOnline:e}),new r_(r,{},{keys:[s.apiSecretKey]}).getAndVerify(tT);{n.debug("App is embedded, looking for session id in JWT payload",{isOnline:e});let t=r.headers.Authorization;if(t){let r=("string"==typeof t?t:t[0]).match(/^Bearer (.+)$/);if(!r)throw n.error("Missing Bearer token in authorization header",{isOnline:e}),new x("Missing Bearer token in authorization header");let i=await rR(s)(r[1]),o=i.dest.replace(/^https:\/\//,"");return(n.debug("Found valid JWT payload",{shop:o,isOnline:e}),e)?rD(s)(o,i.sub):rU(s)(o)}n.error("Missing Authorization header, was the request made with authenticatedFetch?",{isOnline:e})}},getOfflineId:rU(s),getJwtSessionId:rD(s),decodeSessionToken:rR(s)},utils:{sanitizeShop:tv(s),sanitizeHost:tE(),validateHmac:tf(s),versionCompatible:rL(s),versionPriorTo:(n=s,(e,t=n.apiVersion)=>!rL(n)(e,t)),shopAdminUrlToLegacyUrl:tb,legacyUrlToShopAdminUrl:tS},webhooks:function(e){let t={};return{addHandlers:function(r){for(let[n,i]of Object.entries(r)){let r=rK(n);if(Array.isArray(i))for(let n of i)rX(e,t,r,n);else rX(e,t,r,i)}},getTopicsAdded:function(){return Object.keys(t)},getHandlers:rW(t),register:async function({session:r}){let n=ee(e);n.info("Registering webhooks",{shop:r.shop});let i=Object.keys(t).reduce((e,t)=>(e[t]=[],e),{}),s=await rz(e,r);for(let o in n.debug(`Existing topics: [${Object.keys(s).join(", ")}]`,{shop:r.shop}),t)!Object.prototype.hasOwnProperty.call(t,o)||C.includes(o)||(i[o]=await rG({config:e,session:r,topic:o,existingHandlers:s[o]||[],handlers:rW(t)(o)}),delete s[o]);for(let t in s){if(!Object.prototype.hasOwnProperty.call(s,t))continue;let n=new(e7({config:e}))({session:r});i[t]=await rY({config:e,client:n,topic:t,handlers:s[t],operation:eh.Delete})}return i},process:async function({context:r,rawBody:n,...s}){let o={statusCode:i.Ok,statusText:r8[i.Ok],headers:{}};await ee(e).info("Receiving webhook request");let a=await r6(e)({rawBody:n,...s}),c="Unknown error while handling webhook";if(a.valid){let i=await r9(e,t,a,n,r);o.statusCode=i.statusCode,(0,e1.t$)(o)||(c=i.errorMessage||c)}else{let t=await r7(e,a);o.statusCode=t.statusCode,o.statusText=r8[o.statusCode],c=t.errorMessage}let l=await (0,e1.d4)(o,s);if(!(0,e1.t$)(o))throw new X({message:c,response:l});return Promise.resolve(l)},validate:r6(e)}}(s),billing:{check:async function(e){if(!s.future?.unstable_managedPricingSupport&&!s.billing)throw new Q({message:"Attempted to look for purchases without billing configs",errorData:[]});let{session:t,isTest:r=!0,plans:n}=e,i=e.returnObject??!1,o=new(e7({config:s}))({session:t}),a=await ne({client:o,isTest:r,plans:n});return s.future?.unstable_managedPricingSupport||i?a:a.hasActivePayment},request:async function({session:e,plan:t,isTest:r=!0,returnUrl:n,returnObject:i=!1,...o}){let a;if(!s.billing||!s.billing[t])throw new Q({message:`Could not find plan ${t} in billing settings`,errorData:[]});let c={...s.billing[t]},l=Object.fromEntries(Object.entries(o).filter(([e,t])=>void 0!==t)),u=e.shop.replace(".myshopify.com",""),p=rH(s)(function(e,t){let r=new TextEncoder().encode(e);switch(t){case e2.C.Base64:return tn(r);case e2.C.Hex:return tt(r);default:throw new $(`Unrecognized hash format '${t}'`)}}(`admin.shopify.com/store/${u}`,e2.C.Base64)),d=`${s.hostScheme}://${s.hostName}?shop=${e.shop}`,h=n||(s.isEmbeddedApp?p:d),f=new(e7({config:s}))({session:e});if("lineItems"in c){let e=function(e,t){let r={...e,...t},n=[];if(e.lineItems&&t.lineItems){for(let r of e.lineItems){let e=!1;for(let i of t.lineItems)if(r.interval===i.interval){n.push({...r,...i}),e=!0;break}e||n.push(r)}r.lineItems=n}return r}(c,l);a=(await nr({billingConfig:e,plan:t,client:f,returnUrl:h,isTest:r})).appSubscriptionCreate}else a=c.interval===es.OneTime?(await ns({billingConfig:{...c,...l},plan:t,client:f,returnUrl:h,isTest:r})).appPurchaseOneTimeCreate:c.interval===es.Usage?(await ni({billingConfig:{...c,...l},plan:t,client:f,returnUrl:h,isTest:r})).appSubscriptionCreate:(await nn({billingConfig:{...c,...l},plan:t,client:f,returnUrl:h,isTest:r})).appSubscriptionCreate;if(a.userErrors?.length)throw new Q({message:"Error while billing the store",errorData:a.userErrors});return i?a:a.confirmationUrl},cancel:async function(e){let{session:t,subscriptionId:r,prorate:n=!0}=e,i=new(e7({config:s}))({session:t});try{let e=await i.request(nc,{variables:{id:r,prorate:n}});if(e.data?.appSubscriptionCancel?.userErrors.length)throw new Q({message:"Error while canceling a subscription",errorData:e.data?.appSubscriptionCancel?.userErrors});return e.data?.appSubscriptionCancel?.appSubscription}catch(e){if(e instanceof J)throw new Q({message:e.message,errorData:e.response?.errors});throw e}},subscriptions:async function({session:e}){if(!s.future?.unstable_managedPricingSupport&&!s.billing)throw new Q({message:"Attempted to look for purchases without billing configs",errorData:[]});let t=new(e7({config:s}))({session:e}),r=await t.request(nl);return r.data?.currentAppInstallation},createUsageRecord:async function(e){let{session:t,subscriptionLineItemId:r,description:n,price:i,idempotencyKey:o,isTest:a=!0}=e,c=new(e7({config:s}))({session:t}),l={description:n,price:i,subscriptionLineItemId:r||await np({client:c,isTest:a})};o&&(l.idempotencyKey=o);try{let e=await c.request(nu,{variables:l});if(e.data?.appUsageRecordCreate?.userErrors.length)throw new Q({message:"Error while creating a usage record",errorData:e.data?.appUsageRecordCreate?.userErrors});return e.data?.appUsageRecordCreate?.appUsageRecord}catch(e){if(e instanceof J)throw new Q({message:e.message,errorData:e.response?.errors});throw e}},updateUsageCappedAmount:async function(e){if(!s.billing)throw new Q({message:"Attempted to update line item without billing configs",errorData:[]});let{session:t,subscriptionLineItemId:r,cappedAmount:{amount:n,currencyCode:i}}=e,o=new(e7({config:s}))({session:t});try{let e=await o.request(nd,{variables:{id:r,cappedAmount:{amount:n,currencyCode:i}}});if(e.data?.appSubscriptionLineItemUpdate?.userErrors.length)throw new Q({message:"Error while updating usage subscription capped amount",errorData:e.data?.appSubscriptionLineItemUpdate?.userErrors});return{confirmationUrl:e.data?.appSubscriptionLineItemUpdate?.confirmationUrl,appSubscription:e.data?.appSubscriptionLineItemUpdate?.appSubscription}}catch(e){if(e instanceof J)throw new Q({message:e.message,errorData:e.response?.errors});throw e}}},flow:{validate:async function({rawBody:e,...t}){return ty(s)({type:el.Flow,rawBody:e,...t})}},fulfillmentService:{validate:async function({rawBody:e,...t}){return ty(s)({type:el.FulfillmentService,rawBody:e,...t})}},logger:ee(s),rest:{}};return t&&(o.rest=function({resources:e,config:t,RestClient:r}){let n=Object.keys(e)[0];return t.apiVersion!==e[n].apiVersion&&ee(t).warning(`Loading REST resources for API version ${e[n].apiVersion}, which doesn't match the default ${t.apiVersion}`),Object.fromEntries(Object.entries(e).map(([e,n])=>{class i extends n{}return i.setClassProperties({Client:r,config:t}),Object.entries(i.hasOne).map(([e,n])=>{n.setClassProperties({Client:r,config:t})}),Object.entries(i.hasMany).map(([e,n])=>{n.setClassProperties({Client:r,config:t})}),Reflect.defineProperty(i,"name",{value:e}),[e,i]}))}({resources:t,config:s,RestClient:ts({config:s})})),o.logger.info(`version ${Z}, environment ${(0,ef.e)()}`).catch(e=>console.log(e)),function(e,t){if(!e._logDisabledFutureFlags)return;let r=(e,r)=>t.info(`Future flag ${e} is disabled.

  ${r}
`);e.future?.lineItemBilling||r("lineItemBilling","Enable this flag to use the new billing API, that supports multiple line items per plan."),e.future?.v10_lineItemBilling&&t.deprecated("12.0.0","v10_lineItemBilling will become enabled in v11. Use flag lineItemBilling instead"),e.future?.customerAddressDefaultFix||r("customerAddressDefaultFix","Enable this flag to change the CustomerAddress classes to expose a 'is_default' property instead of 'default' when fetching data."),e.future?.unstable_managedPricingSupport||r("unstable_managedPricingSupport","Enable this flag to support managed pricing, so apps can check for payments without needing a billing config. Learn more at https://shopify.dev/docs/apps/launch/billing/managed-pricing")}(s,o.logger),o}},3233:(e,t,r)=>{let n;r.d(t,{E:()=>n});try{n=crypto}catch(e){}},2377:(e,t,r)=>{var n;r.d(t,{C:()=>n}),function(e){e.Base64="base64",e.Hex="hex"}(n||(n={}))},7523:(e,t,r)=>{function n(e){return e.replace(/(^|-)(\w+)/g,(e,t,r)=>t+r.slice(0,1).toUpperCase()+r.slice(1).toLowerCase())}function i(e,t){let r=[];if(!e)return r;let i=n(t);for(let[t,s]of Object.entries(e))n(t)===i&&(Array.isArray(s)?r.push(...s):r.push(s));return r}function s(e,t){if(e)return i(e,t)?.[0]}function o(e,t,r){c(e);let i=n(t),s=e[i];s?Array.isArray(s)||(s=[s]):s=[],e[i]=s,s.push(r)}function a(e){return"number"==typeof e?e.toString():e}function c(e){for(let[t,r]of Object.entries(e)){let i=n(t);e[i]||(e[i]=[]),Array.isArray(e[i])||(e[i]=[a(e[i])]),t!==i&&(delete e[t],e[i].push(...[r].flat().map(e=>a(e))))}return e}function l(e,t){c(e);let r=n(t);delete e[r]}function u(e){return e?Object.entries(e).flatMap(([e,t])=>Array.isArray(t)?t.map(t=>[e,t]):[[e,t]]):[]}r.d(t,{G:()=>u,H7:()=>c,NI:()=>o,_b:()=>s,dJ:()=>i,k9:()=>l})},245:(e,t,r)=>{function n(e){return e.statusCode>=200&&e.statusCode<=299}r.d(t,{HJ:()=>u,RK:()=>c,Vr:()=>a,d4:()=>l,jX:()=>s,lY:()=>i,op:()=>d,ph:()=>o,s$:()=>p,t$:()=>n}),r(3233),r(2377);let i=()=>{throw Error("Missing adapter implementation for 'abstractFetch' - make sure to import the appropriate adapter for your platform")};function s(e){i=e}let o=()=>{throw Error("Missing adapter implementation for 'abstractConvertRequest' - make sure to import the appropriate adapter for your platform")};function a(e){o=e}let c=()=>Promise.resolve({}),l=()=>{throw Error("Missing adapter implementation for 'abstractConvertResponse' - make sure to import the appropriate adapter for your platform")};function u(e){l=e}let p=()=>{throw Error("Missing adapter implementation for 'abstractConvertHeaders' - make sure to import the appropriate adapter for your platform")};function d(e){p=e}},2014:(e,t,r)=>{r.d(t,{c:()=>i,e:()=>n});let n=()=>{throw Error("Missing adapter implementation for 'abstractRuntimeString' - make sure to import the appropriate adapter for your platform")};function i(e){n=e}}};